"use strict";function generateHtmlCategory(e,t,a){return html='<li class="js-category-item-'+e+' category__item"> <a class="category__link" href="#">',html+=t,html+='<span class="category__price">'+number_format(a,0," "," ")+' <i class="fa fa-rub"></i></span>',html+='</a><span class="category__icon js-category--reset" data-id="'+e+'"></span>',html+="</li>",html}function countServices(){var e=$(".js-service-count"),t=$(".js-service-price"),a=0,r=0;$(".card-services-item.is-booked").each(function(){r+=parseInt($(this).data("price")),a+=1}),e.attr("data-count",a),t.html(number_format(r,0," "," ")+' <i class="fa fa-rub"></i>')}function countServicesIDs(e,t){var a=t.indexOf(e);return-1<a?t.splice(a,1):t.push(e),t}function sendOrder(){var t=$(".js-service-price").text();$.ajax({method:"POST",url:"/submitNewRequest",data:{order:localStorage.getItem("orderToMaster"),_token:token}}).done(function(e){!0===e.success&&($(".js-order-main-form").addClass("is-success"),fbq("track","AddToCart",{content_name:"Заявка",value:t,currency:"RUB"}))})}function initCardMap(){var e,t,a,r=$(".js-card__map"),n=r.data("x"),s=r.data("y");e=new ymaps.Map("card-map",{center:[n,s],zoom:15}),a={iconLayout:"default#image",iconImageHref:"/templates/bazar/index/img/general/map-pin.svg",iconImageSize:[30,42],iconImageOffset:[-3,-42]},t=new ymaps.Placemark([n,s],{},a),e.controls.add("typeSelector"),e.geoObjects.add(t)}function updateOrderInfo(e,t,a,r,n){var s=a.price,o=s*e;if(0<$(".js-order-cart-page").length){var i=n.parent().parent().next(),c=n.parent().parent().prev(),d=n.parent().find(".js-arr-final-data"),l=n.parent().find(".js-type-product").val(),u=n.parent().find(".js-current-price-int"),p=number_format(o,2,"."," ")+"<span>  руб.</span>";i.html(p),u.val(o),getAllProductsSum()}else{i=$(".js-card__order-info"),c=$(".js-card__price"),d=$(".js-arr-final-data");var m=JSON.parse(t.val())[0].count;if(1==(l=$(".js-type-product").val())||2==l||3==l||5==l||7==l){if(m<=e){p="В корзине <span>"+e+"</span> метров — <span>"+number_format(o,2,"."," ")+"</span> руб.";i.html(p)}}else if(m<=e){p="В корзине <span>"+e+"</span> шт — <span>"+number_format(o,2,"."," ")+"</span> руб.";i.html(p)}}if(1==l||2==l||3==l||5==l||7==l)var h=number_format(s,2,"."," ")+" <span>руб/м</span>";else h=number_format(s,2,"."," ")+" <span>руб/шт</span>";a.count=e,d.val(JSON.stringify(a)),a.discount?h=h+"<small>-"+a.discount+"%</small>":a.discount=null,c.html(h),$.ajax({method:"POST",url:"/ajaxAddProductToCart",data:{productID:r,arrData:JSON.stringify(a),onlyData:!0,_token:token}})}function checkStep(a,e){var r={};return $.each(JSON.parse(e.val()),function(e,t){null!==t.count&&a>=t.count&&(null!==t.discount&&(r.discount=t.discount),r.price=t.price)}),r}function changeInput(e){var t=e,a=t,r=parseInt(a.val()),n=t.parent().find(".js-type-product").val(),s=t.parent().find(".js-arr-prices"),o=t.parent().find(".js-arr-prices").data("id"),i=JSON.parse(s.val())[0].count,c="",d=0;c=1==n||2==n||3==n||5==n||7==n?" м":" шт",t.parent().find(".item-select__title").hide(),d=isNaN(r)?i:r<i?i:r,a.show().val(d+c),updateOrderInfo(d,s,checkStep(d,s),o,t)}function getAllProductsSum(){var a=0;$(".js-current-price-int").each(function(){var e=$(this),t=parseFloat(e.val());a+=t}),$(".js-cart__sum_current").text(number_format(a,2,"."," "))}function auto_layout_keyboard(e){return replacer={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."},e.replace(/[A-z/,.;\'\]\[]/g,function(e){return e==e.toLowerCase()?replacer[e]:replacer[e.toLowerCase()].toUpperCase()})}function number_format(e,t,a,r){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var n,s,o,i=isFinite(+e)?+e:0,c=isFinite(+t)?Math.abs(t):0,d=void 0===r?",":r,l=void 0===a?".":a,u="";return 3<(u=(c?(n=i,s=c,o=Math.pow(10,s),""+Math.round(n*o)/o):""+Math.round(i)).split("."))[0].length&&(u[0]=u[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,d)),(u[1]||"").length<c&&(u[1]=u[1]||"",u[1]+=new Array(c-u[1].length+1).join("0")),u.join(l)}function phoneConfirmTimer(){var r=$(".js-timer");!function a(){setTimeout(function(){var e=r.data("timer");r.text(e);var t=setInterval(function(){-1==--e?(clearInterval(t),r.parent().css("display","none"),$(".js-cabinet-phone-confirm").removeAttr("style")):r.text(e)},1e3);$(".js-cabinet-phone-confirm").on("click",function(e){clearInterval(t),a()})})}()}function addFavorite(e,t){$.ajax({method:"POST",url:"/ajaxAddFavorite",data:{favorite:t,userID:e,_token:token}}).done(function(e){e.success})}function ajaxPhoneShow(){$(".js-user-phone--show").trigger("click")}function ajaxReviewsAdd(e,t){$.fancybox.open($("#review-add")),$(".review-add__title").html(e),$(".reviews__header").attr("data-from",t)}function redirectToCabinet(){$.ajax({method:"POST",url:"/ajaxRedirectToCabinet",data:{_token:token}}).done(function(e){if(!0===e.success){var t=e.route;location.replace(t)}})}function getCity(){$(".js-search-alias__input").val(cityAlias)}function generateHtmlBlockMetro(e,t){var a='<li class="metro-checked__item">';return a+=e,a+='<i class="fa fa-times js-metro-delete__icon metro-checked__icon" data-id="'+t+'"></i>',a+="</li>"}function generateHtmlBlockDistrict(e,t){var a='<li class="metro-checked__item">';return a+=e,a+='<i class="fa fa-times js-district-delete__icon metro-checked__icon" data-id="'+t+'"></i>',a+="</li>"}function generateUrlArray(){var s=[],e=window.location.search.substring(1).split("&");return""!=e&&$.each(e,function(e,t){var a,r,n=t.split("=");a=n[0],r=n[1],s[a]=r}),s}function updateUrlArray(e,t,a,r,n){n=n||!1;if(e[t]){var s=e[t];if(""!=(s=s.toString())&&-1!==s.indexOf(",")){var o=e[t].split(",");if("add"===r){var i=0;$.each(o,function(e,t){t===a&&i++}),0===i&&(e[t]=e[t]+","+a)}"delete"===r&&($.each(o,function(e,t){t==a&&o.splice(e,1)}),e[t]=o.join(","))}if(""!=s&&-1===s.indexOf(",")){o=e[t];"add"===r&&(n?e[t]=a:o!=a&&(e[t]=e[t]+","+a)),"delete"===r&&o==a&&delete e[t]}}else e[t]=a;return e}function generateStingFromArray(t){var a="?";return Object.keys(t).forEach(function(e){a="?"==a?a+e+"="+t[e]:a+"&"+e+"="+t[e]}),a}function ajaxFilter(){location.pathname.split("/")[1]?(nameFilter=location.pathname.split("/")[1],location.pathname.split("/")[2]?nameType=location.pathname.split("/")[2]:nameType=""):(nameFilter="",nameType=""),$.ajax({method:"POST",url:"/ajaxAddContent",data:{cityID:cityID,cityAlias:$(".js-catalog__city-breadcrumbs").data("alias"),globalParams:JSON.stringify(window.location.search.substring(1).split("&")),categoryID:$(".js-catalog-filter__category").data("category"),nameFilter:nameFilter,nameType:nameType,_token:token}}).done(function(e){!0===e.success&&($(".js-product-item__wrap").html(e.html),$(".js-count-masters").text(e.countProducts),0===e.countProducts?$(".js-catalog-empty").removeClass("is-hidden"):$(".js-catalog-empty").addClass("is-hidden"),$("#nextPrev").html(e.arrNextPrev),$("html, body").animate({scrollTop:0},800))})}function ajaxAddContent(e,t){location.pathname.split("/")[1]?(nameFilter=location.pathname.split("/")[1],location.pathname.split("/")[2]?nameType=location.pathname.split("/")[2]:nameType=""):(nameFilter="",nameType=""),$(".js-loader__scroll").removeClass("is-hidden"),$(".product-item").each(function(){e++}),$.ajax({method:"POST",url:"/ajaxAddContent",data:{cityID:cityID,cityAlias:$(".js-catalog__city-breadcrumbs").data("alias"),globalParams:JSON.stringify(window.location.search.substring(1).split("&")),categoryID:$(".js-catalog-filter__category").data("category"),skip:e,nameFilter:nameFilter,nameType:nameType,allCountMasters:t,_token:token}}).done(function(e){if(!0===e.success){var t=$(".js-loader__scroll");t.addClass("is-hidden"),$(".js-product-item__wrap").append(e.html),(0===e.countProducts||e.countProducts<e.countCatalog)&&t.addClass("the-end")}})}function addMastersToContent(e,t,a,r){$(window).scroll(function(){checkVisibility(a)||(t=0),0===t&&(checkVisibility(a)?(t=1,$(".js-loader__scroll").hasClass("the-end")||ajaxAddContent(e,r)):t=0)})}function sendAjax(){$(".js-loader__scroll").removeClass("the-end"),480<=$(window).width()&&ajaxFilter()}function checkVisibility(e){var t=$(window).scrollTop(),a=t+$(window).height(),r=$(e).offset().top;$(e).height();return r<=a&&t<=r}function getUrlVars(){for(var e,t=[],a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),r=0;r<a.length;r++)e=a[r].split("="),t.push(e[0]),t[e[0]]=e[1];return t}$(document).ready(function(){var e,t=0;if(0<$(".card-services__items").length){var a=$(".card-services__items").children(".js-bb-accordeon").children(".bb-accordeon__item");a.filter(":first").addClass("is-open"),a.filter(":first").children(".bb-accordeon__content").css("display","block")}0<$(".lk-service__inner").length&&((e=$(".lk-service__inner").children(".js-bb-accordeon").children(".bb-accordeon__item")).filter(":first").addClass("is-open"),e.filter(":first").children(".bb-accordeon__content").css("display","block"));0<$(".profile-editor__inner").length&&((e=$(".profile-editor__inner").children(".js-bb-accordeon").children(".bb-accordeon__item")).filter(":first").addClass("is-open"),e.filter(":first").children(".bb-accordeon__content").css("display","block"));if(0<$(".js-reviewsContent").length&&$(".js-reviewsContent").on("click",function(){return $(".js-reviews__message").each(function(){t++}),$.ajax({method:"POST",url:"/ajaxAddReviews",data:{userID:$(this).data("id"),skip:t,_token:token}}).done(function(e){!0===e.success&&(""==e.html?$(".js-reviewsContent").parent().remove():$(".reviews__messages").append(e.html))}),t=0}),0<$(".js-review--add").length&&$(".js-review--add").on("click",function(){var e=$("input[name='rating']:checked").val(),t=$("#js-review-message").val(),a=$(".reviews__header").data("to"),r=$(".reviews__header").data("from"),n=$(".reviews__header").data("cityAlias");null==e||""==t?console.log("Введите данные"):$.ajax({method:"POST",url:"/ajaxNewReviews",data:{stars:e,message:t,toUserID:a,fromUserID:r,cityAlias:n,active:0,_token:token}}).done(function(e){!0===e.success&&$(".review-add").addClass(" is-success")})}),0<$(".js-registerFB").length&&$(".js-registerFB").on("click",function(){fbq.push(["track","Lead",{content_name:"Создать нового пользователя"}])}),0<$(".changer__reset").length&&$(".changer__reset").on("click",function(e){var t="",a="",r="";location.pathname.split("/")[1]&&(t=location.pathname.split("/")[1],location.pathname.split("/")[2]&&(a=location.pathname.split("/")[2]),"furniture"===t&&location.pathname.split("/")[3]&&(r=location.pathname.split("/")[3])),document.location.href=""===r?location.origin+"/"+t:location.origin+"/"+t+"/"+a+"/"+r,e.preventDefault()}),$(document).on("click",".js-color-item",function(e){var t=$(this).closest(".js-product-item"),a=$(this).data("colorid"),r=t.find(".product-slider__list"),n=$(this).parent().parent().parent().find(".js-product-add-to-cart");$.ajax({method:"POST",url:"/ajaxSliderProduct",data:{productID:a,_token:token}}).done(function(e){!0===e.success&&(t.attr("data-product",a),n.attr("data-id",a),t.find(".js-btn-fav").remove(),r.html(e.html),t.find(".js-ajax-favorite").append(e.favoriteBtn))}),e.preventDefault()}),0<$(".catalog-filter__cloth").length){var r=$(document).find(".cloth__item"),n=0;r.each(function(e){var t=r[e].getElementsByTagName("li"),a=[];[].push.apply(a,t),$.each(a,function(e,t){n=+n+ +t.dataset.count}),r[e].getElementsByClassName("cloth__count")[0].innerHTML=+n+ +r[e].dataset.count,n=0})}}),$(document).ready(function(){}),$(document).ready(function(){0<$(".js-profile__name").length&&(e=30-(e=$(".js-profile__name").val().length),$(".js-countForName").html(+e),$(".js-profile__name").keyup(function(){var e=$(this);30<e.val().length&&e.val(e.val().substr(0,30));var t=$(".js-profile__name").val().length;t=30-t,$(".js-countForName").html(+t)}));$(".js-profile__email").blur(function(){if(""!=$(this).val()){/^([a-z0-9_\.-])+@[a-z0-9-]+\.([a-z]{2,4}\.)?[a-z]{2,4}$/i.test($(this).val())?$(this).css({border:"1px solid #569b44"}):($(this).css({border:"1px solid #ff0000"}),$(".valid").text("E-mail введен не верно"))}}),0<$(".js-ajax-logout").length&&$(".js-ajax-logout").on("click",function(){$.ajax({method:"POST",url:"/ajaxLogout",data:{_token:token}}).done(function(e){if(!0===e.success){var t=e.route;location.replace(t)}})}),0<$(".js-master").length&&$(".js-master").on("click",function(){var e=$(this).data("user");$.ajax({method:"POST",url:"/ajaxGetMaster",data:{userID:e,_token:token}}).done(function(e){!0===e.success&&(window.location.href=e.cabinetMaster)})}),0<$(".js-master-page").length&&$(".js-master-page").on("click",function(){$.ajax({method:"POST",url:"/ajaxPageMaster",data:{_token:token}}).done(function(e){if(!0===e.success){var t=e.route;location.replace(t)}})});var a=300,r=500;if(0<$(".js-profile-editor").length){var e=$(".js-profile__name").val().length;e=a-e,$(".js-countForTextarea").html(+e)}if($(".js-profile-editor").keyup(function(){var e=$(this);e.val().length>a&&e.val(e.val().substr(0,a));var t=$(".js-profile-editor").val().length;t=a-t,$(".js-countForTextarea").html(+t)}),0<$(".js-profile-editor2").length){e=$(".js-profile__name").val().length;e=r-e,$(".js-countForTextarea2").html(+e)}$(".js-profile-editor2").keyup(function(){var e=$(this);e.val().length>r&&e.val(e.val().substr(0,r));var t=$(".js-profile-editor2").val().length;t=r-t,$(".js-countForTextarea2").html(+t)})}),$(document).on("click",".js-ajax-open-preview",function(e){e.stopPropagation();var t=$(this).prev().find(".js-btn-fav").data("favorite"),a=$("#nextPrev").text(),r=JSON.parse("["+a+"]");$.ajax({method:"POST",url:"/ajaxOpenPreviewProduct",data:{productID:t,nextPrev:r,cityAlias:cityAlias,_token:token}}).done(function(e){!0===e.success&&($("#preview").html(e.html),$("#preview").modal(),modalSlider(),sliderRelatedModal(),changeColor(),zoom(),$(".js-card-tab-related--modal").tabs())}),e.preventDefault()}),$(document).on("click",".js-ajax-open-preview-in-mobile",function(e){e.stopPropagation();var t=$(this).parent().find(".js-btn-fav").data("favorite"),a=$("#nextPrev").text(),r=JSON.parse("["+a+"]");$.ajax({method:"POST",url:"/ajaxOpenPreviewProduct",data:{productID:t,nextPrev:r,cityAlias:cityAlias,_token:token}}).done(function(e){!0===e.success&&($("#preview").html(e.html),$("#preview").modal(),modalSlider(),sliderRelatedModal(),changeColor(),zoom(),$(".js-card-tab-related--modal").tabs())}),e.preventDefault()}),$(document).on("click",".js-ajax-open-preview-button",function(e){var t=$(this).parent().parent().prev().prev().find(".js-btn-fav").data("favorite"),a=$("#nextPrev").text(),r=JSON.parse("["+a+"]");$.ajax({method:"POST",url:"/ajaxOpenPreviewProduct",data:{productID:t,cityAlias:cityAlias,nextPrev:r,_token:token}}).done(function(e){!0===e.success&&($("#preview").html(e.html),$("#preview").modal(),modalSlider(),sliderRelatedModal(),changeColor(),zoom(),$(".js-card-tab-related--modal").tabs())}),e.preventDefault()}),$(document).on("click",".js-ajax-open-preview-in-preview",function(e){var t=$(this).data("product"),a=$("#nextPrev").text(),r=JSON.parse("["+a+"]");$.ajax({method:"POST",url:"/ajaxOpenPreviewProduct",data:{productID:t,cityAlias:cityAlias,nextPrev:r,_token:token}}).done(function(e){!0===e.success&&($("#preview").html(e.html),$("#preview").modal(),modalSlider(),sliderRelatedModal(),changeColor(),zoom(),$(".js-card-tab-related--modal").tabs())}),e.preventDefault()}),$(document).ready(function(){if(0<$(".card__content_inner").length){var c=[],a={},d=$(".js-order-main-block"),r={},n=$("#js-order-date-input"),s=$("#js-order-timeFrom-select"),o=$("#js-order-phone-input");$(".js-card-services-item").on("click",function(e){if(!$(e.target).closest(".card-services-item__middle").length&&!$(e.target).closest(".card-services-item__info-block").length){if(d.hasClass("is-disabled"))return!1;d.hasClass("is-booked")||d.addClass("is-booked");var t=$(this),a=t.find(".card-services-item__action_add"),r=t.find(".card-services-item__action_done"),n=$(".js-categories-block"),s=t.data("id"),o=t.data("name"),i=t.data("price");c=countServicesIDs(s,c),t.hasClass("is-booked")?($(".js-category-item-"+s).remove(),t.removeClass("is-booked"),a.removeAttr("style"),r.removeAttr("style")):($(".js-empty-services-count").addClass("is-hidden"),n.append(generateHtmlCategory(s,o,i)),t.addClass("is-booked"),fbq("track","InitiateCheckout"),fbq("trackCustom","Добавление услуги",{"Название":o}),a.css("display","none"),r.css("display","block")),countServices()}}),$(document).on("click",".js-category--reset",function(){if(d.hasClass("is-disabled"))return!1;var e=$(this).data("id"),t=$(".js-card-service-block-"+e),a=t.find(".card-services-item__action_add"),r=t.find(".card-services-item__action_done");c=countServicesIDs(e,c),t.removeClass("is-booked"),a.removeAttr("style"),r.removeAttr("style"),countServices(),$(this).parent().remove()}),$(".js-card-request--show").on("click",function(){if(d.hasClass("is-booked")){var e=0;if(n.parent().removeClass("is-invalid"),o.parent().removeClass("is-invalid"),$(window).width()<=768?$(this).addClass("is-attention"):0===c.length&&($(".js-empty-services-count").removeClass("is-hidden"),e++),""===n.val()&&(n.parent().addClass("is-invalid"),e++),""===o.val()&&(o.parent().addClass("is-invalid"),e++),0<e)return!1;d.addClass("is-disabled");var t=n.val();t=(t=t.split("."))[2]+"."+t[1]+"."+t[0],a.phone=o.val(),a.date=t,a.timeFrom=s.val(),a.masterID=$("#js-card-user__name").data("id"),r.data=a,r.services=c,localStorage.setItem("orderToMaster",JSON.stringify(r)),$.ajax({method:"POST",url:"/ajaxCheckUserForConfirm",data:{phone:o.val(),_token:token}}).done(function(e){return!1===e.success&&!0===e.authForm?(localStorage.setItem("cardRoute","true"),$.fancybox.open($(".header-action__login")),!1):!1===e.success&&!0===e.confirmPhoneBlock?($(".js-order-main-form").addClass("is-confirm"),!1):!1===e.success&&!0===e.phoneError?(o.parent().addClass("is-invalid"),o.next().text("Пользователь с таким номером уже существут"),d.removeClass("is-disabled"),!1):!0===e.success?(sendOrder(),!1):void 0})}else d.addClass("is-booked");return!1}),$(".js-sms-confirm-button__order").on("click",function(){var e=$("#js-sms-confirm-input__order").val(),t=$("#js-sms-confirm-error__order");return""==e?t.show().text("Введите код из SMS сообщения"):$.ajax({method:"POST",url:"/ajaxConfirmSms",data:{confirmValue:e,updateUser:!0,_token:token}}).done(function(e){!0===e.success?sendOrder():t.show().text("Не верный код")}),!1}),0<$(".js-card__map").length&&ymaps.ready(initCardMap)}}),$(document).ready(function(){$(document).on("click",".js-product-add-to-cart",function(e){e.preventDefault();var t=$(this),a=t.data("id");$.ajax({method:"POST",url:"/ajaxAddProductToCart",data:{productID:a,count:1,_token:token}}).done(function(e){!0===e.success&&($(".js-user-nav__item--cart").attr("data-cart-counter",e.productCount),pushUp(),t.hide(),t.next().removeClass("is-hidden"))})}),$(document).on("click",".js-product-add-to-cart-more",function(e){e.preventDefault();var d=$(this),t=d.data("id"),a=$(".js-arr-final-data").val();$.ajax({method:"POST",url:"/ajaxAddProductToCart",data:{productID:t,arrData:a,_token:token}}).done(function(e){if(!0===e.success){$(".js-user-nav__item--cart").attr("data-cart-counter",e.productCount),pushUp(),d.addClass("is-hidden"),d.next().removeClass("is-hidden");var t=JSON.parse(e.arrData),a=$(".js-cart-count"),r=$(".js-card__order-info"),n=$(".js-card__price"),s=d.parent().parent().prev().find(".js-type-product").val(),o=(n=$(".js-card__price"),t.count*t.price);if(1==s||2==s||3==s||5==s||7==s){var i="В корзине <span>"+t.count+"</span> метров — <span>"+number_format(o,2,"."," ")+"</span> руб.";a.show().val(t.count+" м");var c=number_format(t.price,2,"."," ")+" <span>руб/м</span>"}else{i="В корзине <span>"+t.count+"</span> шт — <span>"+number_format(o,2,"."," ")+"</span> руб.";a.show().val(t.count+" шт");c=number_format(t.price,2,"."," ")+" <span>руб/шт</span>"}t.discount&&(c=c+"<small>-"+t.discount+"%</small>"),n.html(c),r.html(i),a.prev().hide()}})}),$(document).on("click",".js-cart-plus",function(e){e.preventDefault(),e.stopPropagation();var t=$(this),a=t.parent().find(".js-cart-count"),r=parseInt(a.val()),n=t.parent().find(".js-type-product").val(),s=t.parent().find(".js-arr-prices"),o=t.parent().find(".js-arr-prices").data("id"),i=JSON.parse(s.val())[0].count,c="",d=0;c=1==n||2==n||3==n||5==n||7==n?" м":" шт",t.parent().find(".item-select__title").hide(),isNaN(r)?d=i:(r<i&&(d=i),i<=r&&(d=r+1)),a.show().val(d+c),updateOrderInfo(d,s,checkStep(d,s),o,t)}),$(document).on("click",".js-cart-minus",function(e){e.preventDefault(),e.stopPropagation();var t=$(this),a=t.parent().find(".js-cart-count"),r=parseInt(a.val()),n=t.parent().find(".js-type-product").val(),s=t.parent().find(".js-arr-prices"),o=t.parent().find(".js-arr-prices").data("id"),i=JSON.parse(s.val())[0].count,c="",d=0;if(c=1==n||2==n||3==n||5==n||7==n?" м":" шт",t.parent().find(".item-select__title").hide(),isNaN(r))d=i;else{if(r===i)return!1;i<r&&(d=r-1)}a.show().val(d+c),updateOrderInfo(d,s,checkStep(d,s),o,t)}),$(document).on("change",".js-cart-count",function(e){e.preventDefault(),e.stopPropagation(),changeInput($(this))}),$(document).on("click",".js-item-select__item",function(e){changeInput($(this).parent().prev().find(".js-cart-count"))}),$(document).on("click",".js-delete-from-cart__more",function(){var a=$(this),e=$(this).data("id");return $.ajax({method:"POST",url:"/ajaxDeleteProductFromCart",data:{productID:e,_token:token}}).done(function(e){if(!0===e.success){$(".js-card__order-info").html("");var t=$(".js-cart-count");t.prev().show(),t.hide().val(""),pushUp("Товар удален из корзины"),a.parent().addClass("is-hidden"),$(".js-product-add-to-cart-more").removeClass("is-hidden"),$(".js-user-nav__item--cart").attr("data-cart-counter",e.productCount),$(".js-item-count-cart").text(e.productCount)}}),!1}),$(document).on("click",".js-delete-from-cart__order",function(){var t=$(this),e=$(this).data("id");return $.ajax({method:"POST",url:"/ajaxDeleteProductFromCart",data:{productID:e,_token:token}}).done(function(e){!0===e.success&&(pushUp("Товар удален из корзины"),t.closest(".product-item").remove(),$(".js-user-nav__item--cart").attr("data-cart-counter",e.productCount),$(".js-item-count-cart").text(e.productCount),getAllProductsSum())}),!1});var d=$(".js-send-order__button");0<d.length&&d.on("click",function(){var e=$(".js-order__name"),t=$(".js-order__lastName"),a=$(".js-order__phone"),r=$(".js-order__email"),n=$(".js-order__city"),s=$(".js-order__zip"),o=$(".js-order__street"),i=$(".js-order__house"),c=($(".js-order__police"),0);if($(".js-order-input").on("input",function(){$(this).parent().removeClass("is-invalid")}),""===e.val()&&(e.parent().addClass("is-invalid"),c++),""===a.val()&&(a.parent().addClass("is-invalid"),c++),""===r.val()&&(r.parent().addClass("is-invalid"),c++),""!=r.val()){/^([a-z0-9_\.-])+@[a-z0-9-]+\.([a-z]{2,4}\.)?[a-z]{2,4}$/i.test(r.val())?(r.next().css("display","none"),r.css({border:"1px solid #d9d9d9"})):(r.css({border:"1px solid #ff0000"}),r.next().css("display","block"),r.next().text("Введите правильный email"),c++)}return""===n.val()&&(n.parent().addClass("is-invalid"),c++),""===s.val()&&(s.parent().addClass("is-invalid"),c++),""===o.val()&&(o.parent().addClass("is-invalid"),c++),""===i.val()&&(i.parent().addClass("is-invalid"),c++),0<c||($("#preloaderSend").removeClass("is-hidden"),d.attr("disabled","disabled"),$.ajax({method:"POST",url:"/ajaxSendOrder",data:{name:e.val(),lastName:t.val(),phone:a.val(),email:r.val(),city:n.val(),zip:s.val(),street:o.val(),house:i.val(),_token:token}}).done(function(e){!0===e.success&&($("#preloaderSend").addClass("is-hidden"),d.removeAttr("disabled"),$(".js-order__form").addClass("is-success"),$(".js-cart-title").remove(),$(".js-cart-items").remove(),$(".js-cart-items__info").remove(),$(".js-user-nav__item--cart").attr("data-cart-counter",0))})),!1})}),$(document).ready(function(){var e=$(".bb-upload__loader");if($(document).ajaxStart(function(){0<e.length&&e.show()}),$(document).ajaxStop(function(){0<e.length&&e.hide()}),0<$(".js-contact__map").length&&ymaps.ready(function(){var e,t,a,r=$(".js-contact__map"),n=r.data("x"),s=r.data("y");e=new ymaps.Map("card-map",{center:[n,s],zoom:15}),a={iconLayout:"default#image",iconImageHref:"/templates/bazar/index/img/general/map-pin.svg",iconImageSize:[30,42],iconImageOffset:[-3,-42]},t=new ymaps.Placemark([n,s],{},a),e.controls.remove("typeSelector"),e.geoObjects.add(t)}),localStorage.setItem("orders",123),localStorage.removeItem("cardRoute"),0<$("#js-main-auth-form").length){$(".js-main-auth-form-block");$("#js-login-account").on("click",function(){var t=$("#js-main-input-email").val(),a=$("#js-main-input-password").val(),r=$("#js-main-input-remember").val(),n=$("#js-auth-error");return $.ajax({method:"POST",url:"/ajaxValidateMainAuth",data:{email:t,password:a,_token:token}}).done(function(e){if(!0===e.success){if(!0===e.userExist)return $(".js-header-profile-block").html(e.html),$(".js-header-profile-block-favorite").html(e.favorite),$(".modal__btn--close").trigger("click"),e.addFavoriteFirstAuth&&(userID=e.user,addFavorite(e.user,e.addFavoriteFirstAuth)),!1;$.ajax({method:"POST",url:"/ajaxRegisterUserByEmail",data:{email:t,password:a,remember:r,_token:token}}).done(function(e){!0===e.success&&($(".js-header-profile-block").html(e.html),$(".js-header-profile-block-favorite").html(e.favorite),$(".modal__btn--close").trigger("click"))})}else n.show().html(e.text)}),!1})}if($(document).on("click",".js-btn-fav",function(e){var t=$(this);if(e.stopPropagation(),t.hasClass("is-checked")){t.removeClass("is-checked");var a=$(this).data("favorite");return localStorage.setItem("favorite",a),$.ajax({method:"POST",url:"/ajaxDeleteFavorite",data:{favorite:a,userID:userID,_token:token}}).done(function(e){1==e.success&&console.log("Удален из избранного")}),!1}a=$(this).data("favorite");return t.addClass("is-checked"),$.ajax({method:"POST",url:"/ajaxAddFavorite",data:{favorite:a,userID:userID,_token:token}}).done(function(e){if(!1===e.success&&!0===e.authForm)return $("#auth-form").modal(),!1;1==e.success&&console.log("Добавлен в изранное")}),!1}),0<$(".js-ajax-show-phone").length&&$(document).on("click",".js-ajax-show-phone",function(){$(this).addClass("js-user-phone--show"),localStorage.setItem("cardRoute","true"),$.ajax({method:"POST",url:"/ajaxPhoneShow",data:{_token:token}}).done(function(e){if(!1===e.success&&!0===e.authForm)return $.fancybox.open($(".header-action__login")),!1})}),0<$(".ajax-reviews-add").length&&$(document).on("click",".ajax-reviews-add",function(){localStorage.setItem("cardRoute","true"),$.ajax({method:"POST",url:"/ajaxReviewsAdd",data:{_token:token}}).done(function(e){return!1===e.success&&!0===e.authForm?($.fancybox.open($(".header-action__login")),!1):!0===e.success?($.fancybox.open($("#review-add")),!1):void 0})}),0<$(".js-search__form").length){var c,s=$(".js-search-input__cities"),d=$(".js-search-input__category"),o=$(".js-search-group__cities"),l=$(".js-search-group__categories"),i=$(".js-search-hint__cities"),u=$(".js-search-hint__category");d.on("keyup",function(e){var t=u.find(".is-selected");if(13===e.keyCode){var a=$(".js-search-category__input"),r=$(".js-search-service__input");if(0<t.find(".js-search-input__link-category").length){var n=t.find(".js-search-input__link-category");c=n.data("name");var s=n.data("category");a.val(""),r.val(""),d.val(c),a.val(s),u.hide()}else if(0<t.find(".js-search-input__link-service").length){var o=t.find(".js-search-input__link-service");c=o.data("name");var i=o.data("service");a.val(""),r.val(""),d.val(c),r.val(i),u.hide()}d.attr("onkeydown",!0),$("#searchCategory").trigger("click")}else 40===e.keyCode?t.html()===t.find("li:last-child").html()?(t.removeClass("is-selected"),l.find("li:first-child").addClass("is-selected")):(t.removeClass("is-selected"),t.next().addClass("is-selected")):38===e.keyCode?t.html()===t.find("li:first-child").html()?(t.removeClass("is-selected"),l.find("li:last-child").addClass("is-selected")):(t.removeClass("is-selected"),t.prev().addClass("is-selected")):""!==$(this).val()?$.ajax({method:"POST",url:"/ajaxSearchCategory",data:{catQuery:$(this).val(),_token:token}}).done(function(e){!0===e.success&&(u.show(),l.html("").prepend(e.html))}):u.hide()}),s.on("keyup",function(e){var t=i.find(".is-selected");if(13===e.keyCode){s.attr("onkeydown",!0);var a=t.find("a").data("alias");$(".js-search-alias__input").val(a),$("#searchCity").trigger("click")}else if(40===e.keyCode)t.html()===i.find("li:last-child").html()?(t.removeClass("is-selected"),o.find("li:first-child").addClass("is-selected")):(t.removeClass("is-selected"),t.next().addClass("is-selected"));else if(38===e.keyCode)t.html()===i.find("li:first-child").html()?(t.removeClass("is-selected"),o.find("li:last-child").addClass("is-selected")):(t.removeClass("is-selected"),t.prev().addClass("is-selected"));else{var r=auto_layout_keyboard($(this).val());$(this).val(r);var n=auto_layout_keyboard($(this).val());""!==n?$.ajax({method:"POST",url:"/ajaxSearchCity",data:{cityName:n,mobile:$(this).data("mobile"),_token:token}}).done(function(e){!0===e.success&&(i.show(),o.html("").prepend(e.html),o.find("li:first-child").addClass("is-selected"))}):i.hide()}}),$(document).on("click",".js-search-input__link",function(){var e=$(this).data("name"),t=$(this).data("alias");s.val(e),$(".js-search-alias__input").val(t),$("#searchCity").trigger("click"),i.hide()}),$(document).on("click",".js-search-input__link-category",function(){var e=$(".js-search-category__input"),t=$(".js-search-service__input"),a=($(".js-search-alias__input"),$(this).data("name")),r=$(this).data("category");return e.val(""),t.val(""),d.val(a),e.val(r),u.hide(),d.attr("onkeydown",!0),$("#searchCategory").trigger("click"),!1}),$(document).on("click",".js-search-input__link-service",function(){var e=$(".js-search-category__input"),t=$(".js-search-service__input"),a=$(this).data("name"),r=$(this).data("service");return e.val(""),t.val(""),d.val(a),t.val(r),u.hide(),d.attr("onkeydown",!0),$("#searchCategory").trigger("click"),!1})}var r=$(".js-password-recover__success-block"),t=$(".js-password-recover__phone-button");if(0<t.length){var n=$(".js-password-recover__phone-input");n.on("input",function(){$(this).parent().removeClass("is-invalid")}),t.on("click",function(){var t=$(".js-password-recover__phone-input-error"),a=$(".js-password-recover__phone-success-text");return""===n.val()?(n.parent().addClass("is-invalid"),t.text("Введите телефон")):$.ajax({method:"POST",url:"/ajaxResetPasswordByPhone",data:{phone:n.val(),_token:token}}).done(function(e){!0===e.success?(r.addClass("is-success--phone"),a.text(n.val())):(n.parent().addClass("is-invalid"),t.text("Неверный телефон"))}),!1})}var a=$(".js-password-recover__email-button");if(0<a.length){var p=$(".js-password-recover__email-input");p.on("input",function(){$(this).parent().removeClass("is-invalid")}),a.on("click",function(){var t=$(".js-password-recover__email-input-error"),a=$(".js-password-recover__email-success-text");return""===p.val()?(p.parent().addClass("is-invalid"),t.text("Введите e-mail")):$.ajax({method:"POST",url:"/ajaxSendPasswordResetLink",data:{email:p.val(),_token:token}}).done(function(e){!0===e.success?(r.addClass("is-success"),a.text(p.val())):(p.parent().addClass("is-invalid"),t.text("Неверный e-mail адрес"))}),!1})}var m=$(".js-password-reset__passwords-button");if(0<m.length){var h=$(".js-password-reset__password-input-error"),v=$(".js-password-reset__password-confirm-input-error"),f=$(".js-password-reset__password-input"),_=$(".js-password-reset__password-confirm-input"),j=$(".js-password-recover__token");f.on("input",function(){$(this).parent().removeClass("is-invalid")}),_.on("input",function(){$(this).parent().removeClass("is-invalid")}),m.on("click",function(){return""===f.val()?(f.parent().addClass("is-invalid"),h.text("Введите новый пароль")):f.val().length<6?(f.parent().addClass("is-invalid"),h.text("Пароль не должен быть короче 6 символов")):""===_.val()?(_.parent().addClass("is-invalid"),v.text("Повторите пароль")):_.val()!==f.val()?(_.parent().addClass("is-invalid"),v.text("Пароли не совпадают")):$.ajax({method:"POST",url:"/ajaxResetPassword",data:{password:f.val(),hiddenToken:j.val(),_token:token}}).done(function(e){!0===e.success&&$(".js-password-reset__success-block").addClass("is-success")}),!1})}if(0<$(".js-contacts__form").length){var g=$(".js-contacts__name"),y=$(".js-contacts__phone"),k=$(".js-contact__email"),w=$(".js-contact__message");$(".js-contacts__form-submit").on("click",function(){var e=0;return""===g.val()&&(g.parent().addClass("is-invalid"),e++),""===y.val()&&(y.parent().addClass("is-invalid"),e++),""===k.val()&&(k.parent().addClass("is-invalid"),e++),""===w.val()&&(w.parent().addClass("is-invalid"),e++),0!==e||$.ajax({method:"POST",url:"/ajaxSendContactForm",data:{name:g.val(),phone:y.val(),email:k.val(),message:w.val(),_token:token}}).done(function(e){!0===e.success&&$(".js-contacts__success").addClass("is-active")}),!1})}}),$(document).ready(function(){if(0<$(".js-catalog-filter").length){var s=generateUrlArray();if(addMastersToContent(0,0,$("#js-seo-text-block"),$(".js-catalog-count-masters").data("count")),$("#js-filter-metro").on("change",function(){var e,t,a=$(this).val(),r=$(this).next().text();$(".js-metro-on").append(generateHtmlBlockMetro(r,a)),t=updateUrlArray(s,"metro",a,"add"),e=generateStingFromArray(s=t),window.history.replaceState("url","",e),sendAjax()}),$("#js-filter-district").on("change",function(){var e,t,a=$(this).val(),r=$(this).text();$(".js-district-on").append(generateHtmlBlockDistrict(r,a)),t=updateUrlArray(s,"district",a,"add"),e=generateStingFromArray(s=t),window.history.replaceState("url","",e),sendAjax()}),$(document).on("change",".js-filter-service",function(){var e,t,a=$(this).data("id");t=$(this).hasClass("is-checked")?updateUrlArray(s,"service",a,"add"):updateUrlArray(s,"service",a,"delete"),e=generateStingFromArray(s=t),window.history.replaceState("url","",e),768<$(window).width()&&sendAjax()}),$(document).on("change",".js-filter-color",function(){var e,t,a=$(this).data("color");t=$(this).hasClass("is-checked")?updateUrlArray(s,"color",a,"add"):updateUrlArray(s,"color",a,"delete"),e=generateStingFromArray(s=t),window.history.replaceState("url","",e),768<$(window).width()&&sendAjax()}),$(document).on("change",".js-filter-country",function(){var e,t,a=$(this).data("country");t=$(this).hasClass("is-checked")?updateUrlArray(s,"countries",a,"add"):updateUrlArray(s,"countries",a,"delete"),e=generateStingFromArray(s=t),window.history.replaceState("url","",e),768<$(window).width()&&sendAjax()}),$(document).on("change",".js-filter-cloth",function(){var e,t,a=$(this).data("cloth");t=$(this).hasClass("is-checked")?updateUrlArray(s,"cloth",a,"add"):updateUrlArray(s,"cloth",a,"delete"),e=generateStingFromArray(s=t),window.history.replaceState("url","",e),768<$(window).width()&&sendAjax()}),$(document).on("change",".js-filter-width",function(){var e,t,a=$(this).data("width");t=$(this).hasClass("is-checked")?updateUrlArray(s,"width",a,"add"):updateUrlArray(s,"width",a,"delete"),e=generateStingFromArray(s=t),window.history.replaceState("url","",e),768<$(window).width()&&sendAjax()}),$(document).on("click",".js-metro-delete__icon",function(){var e,t,a=$(this).data("id");$(this).parent().remove(),t=updateUrlArray(s,"metro",a,"delete"),e=generateStingFromArray(s=t),window.history.pushState("url","",e),sendAjax()}),$(document).on("click",".js-district-delete__icon",function(){var e,t,a=$(this).data("id");$(this).parent().remove(),t=updateUrlArray(s,"district",a,"delete"),e=generateStingFromArray(s=t),window.history.pushState("url","",e),sendAjax()}),0<$(".category__list").length&&$(window).width()<769){var a="";a=getUrlVars().category,location.pathname.split("/")[1]&&(a=location.pathname.split("/")[1]),$(".category__list").remove(),"undefined"!==a?$.ajax({method:"POST",url:"/ajaxCatFilter",data:{category:a,_token:token}}).done(function(e){if(!0===e.success){$(".js-category").html(e.html);var t=getUrlVars().service;$.ajax({method:"POST",url:"/ajaxServiceFilter",data:{checked:t,category:a,_token:token}}).done(function(e){!0===e.success&&($(".catalog-filter__category").children(".category__dropdown").remove(),$(".catalog-filter__category").append(e.html))})}}):$.ajax({method:"POST",url:"/ajaxCatFilter",data:{_token:token}}).done(function(e){!0===e.success&&$(".js-category").html(e.html)})}if(0<$(".catalog-filter__item_price").length){var e,t,r,n,o=document.getElementById("js-catalog-filter-slider"),i=$("#js-catalog-filter-slider").data("start"),c=$("#js-catalog-filter-slider").data("end"),d=[$("#jsPriceStart"),$("#jsPriceEnd")];e=""==d[0].text()?i:parseInt(d[0].text()),t=""==d[1].text()?c:parseInt(d[1].text()),noUiSlider.create(o,{start:[e,t],connect:!0,step:10,range:{min:i,max:c}}),o.noUiSlider.on("update",function(e,t){d[t].text(parseInt(e[t]))}),o.noUiSlider.on("change",function(e){updateUrlArray(s,"minPrice",parseInt(e[0]),"add",!0),r=updateUrlArray(s,"maxPrice",parseInt(e[1]),"add",!0),n=generateStingFromArray(s=r),window.history.replaceState("url","",n),sendAjax()})}$(".js-filter-gender").on("change",function(){var e,t,a=$(this).data("gender");e=updateUrlArray(s,"gender",a,"add",!0),t=generateStingFromArray(s=e),window.history.replaceState("url","",t),sendAjax()}),$(window).width()<769&&$(document).on("change",".js-filter-category",function(){var e,t,a=$(this).data("category");delete(e=updateUrlArray(s,"category",a,"add",!0)).service,delete e.category,t=generateStingFromArray(e),window.history.replaceState("url","",t),window.history.pushState("","",a),$.ajax({method:"POST",url:"/ajaxServiceFilter",data:{category:a,_token:token}}).done(function(e){!0===e.success&&($(".catalog-filter__category").children(".category__dropdown").remove(),$(".catalog-filter__category").append(e.html))})}),$(".js-filter-place").on("change",function(){var e,t,a=$(this).data("place"),r=$.getUrlVar("place");if(0!==a)e=updateUrlArray(s,"place",a,"add",!0);else{if(void 0===r)return!1;e=updateUrlArray(s,"place",r,"delete")}t=generateStingFromArray(s=e),window.history.replaceState("url","",t),sendAjax()}),$(".jsSelectSort").on("change",function(){var e,t,a=$(this).val(),r="order",n=$.getUrlVar("order");if(null!==a){if("jsPriceUp"===a)t=updateUrlArray(s,r,"up","add",!0);else if("jsPriceDown"===a){t=updateUrlArray(s,r,"down","add",!0)}else if("jsNewSort"===a){t=updateUrlArray(s,r,"new","add",!0)}else"jsClearSort"===a&&(t=updateUrlArray(s,r,n,"delete"))}else{if(void 0===n)return!1;t=updateUrlArray(s,r,n,"delete")}e=generateStingFromArray(s=t),window.history.replaceState("url","",e),sendAjax()}),$(".js-catalog-filter--close").on("click",function(){return $(".catalog-filter").removeClass("is-open"),$("html").removeAttr("style"),!1}),$(".js-btn-pulse").on("click",function(){var e=window.location.href;window.open(e,"_self")})}}),$.extend({getUrlVars:function(){for(var e,t=[],a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),r=0;r<a.length;r++)e=a[r].split("="),t.push(e[0]),t[e[0]]=e[1];return t},getUrlVar:function(e){return $.getUrlVars()[e]}});