"use strict";$(document).ready(function(){var e,a=0;if(0<$(".card-services__items").length){var t=$(".card-services__items").children(".js-bb-accordeon").children(".bb-accordeon__item");t.filter(":first").addClass("is-open"),t.filter(":first").children(".bb-accordeon__content").css("display","block")}0<$(".lk-service__inner").length&&((e=$(".lk-service__inner").children(".js-bb-accordeon").children(".bb-accordeon__item")).filter(":first").addClass("is-open"),e.filter(":first").children(".bb-accordeon__content").css("display","block"));0<$(".profile-editor__inner").length&&((e=$(".profile-editor__inner").children(".js-bb-accordeon").children(".bb-accordeon__item")).filter(":first").addClass("is-open"),e.filter(":first").children(".bb-accordeon__content").css("display","block"));0<$(".js-reviewsContent").length&&$(".js-reviewsContent").on("click",function(){return $(".js-reviews__message").each(function(){a++}),$.ajax({method:"POST",url:"/ajaxAddReviews",data:{userID:$(this).data("id"),skip:a,_token:token}}).done(function(e){!0===e.success&&(""==e.html?$(".js-reviewsContent").parent().remove():$(".reviews__messages").append(e.html))}),a=0}),0<$(".js-review--add").length&&$(".js-review--add").on("click",function(){var e=$("input[name='rating']:checked").val(),a=$("#js-review-message").val(),t=$(".reviews__header").data("to"),r=$(".reviews__header").data("from"),n=$(".reviews__header").data("cityAlias");null==e||""==a?console.log("Введите данные"):$.ajax({method:"POST",url:"/ajaxNewReviews",data:{stars:e,message:a,toUserID:t,fromUserID:r,cityAlias:n,active:0,_token:token}}).done(function(e){!0===e.success&&$(".review-add").addClass(" is-success")})}),0<$(".js-registerFB").length&&$(".js-registerFB").on("click",function(){fbq.push(["track","Lead",{content_name:"Создать нового пользователя"}])}),0<$(".changer__reset").length&&$(".changer__reset").on("click",function(e){var a="",t="",r="";location.pathname.split("/")[1]&&(a=location.pathname.split("/")[1],location.pathname.split("/")[2]&&(t=location.pathname.split("/")[2]),"furniture"===a&&location.pathname.split("/")[3]&&(r=location.pathname.split("/")[3])),document.location.href=""===r?location.origin+"/"+a:location.origin+"/"+a+"/"+t+"/"+r,e.preventDefault()}),$(document).on("click",".js-color-item",function(e){var a=$(this).closest(".js-product-item"),t=$(this).data("colorid"),r=a.find(".product-slider__list"),n=$(this).parent().parent().parent().find(".js-product-add-to-cart");$.ajax({method:"POST",url:"/ajaxSliderProduct",data:{productID:t,_token:token}}).done(function(e){!0===e.success&&(a.attr("data-product",t),n.attr("data-id",t),a.find(".js-btn-fav").remove(),r.html(e.html),a.find(".js-ajax-favorite").append(e.favoriteBtn))}),e.preventDefault()})}),$(document).ready(function(){}),$(document).ready(function(){0<$(".js-profile__name").length&&(e=30-(e=$(".js-profile__name").val().length),$(".js-countForName").html(+e),$(".js-profile__name").keyup(function(){var e=$(this);30<e.val().length&&e.val(e.val().substr(0,30));var a=$(".js-profile__name").val().length;a=30-a,$(".js-countForName").html(+a)}));$(".js-profile__email").blur(function(){if(""!=$(this).val()){/^([a-z0-9_\.-])+@[a-z0-9-]+\.([a-z]{2,4}\.)?[a-z]{2,4}$/i.test($(this).val())?$(this).css({border:"1px solid #569b44"}):($(this).css({border:"1px solid #ff0000"}),$(".valid").text("E-mail введен не верно"))}}),0<$(".js-ajax-logout").length&&$(".js-ajax-logout").on("click",function(){$.ajax({method:"POST",url:"/ajaxLogout",data:{_token:token}}).done(function(e){if(!0===e.success){var a=e.route;location.replace(a)}})}),0<$(".js-master").length&&$(".js-master").on("click",function(){var e=$(this).data("user");$.ajax({method:"POST",url:"/ajaxGetMaster",data:{userID:e,_token:token}}).done(function(e){!0===e.success&&(window.location.href=e.cabinetMaster)})}),0<$(".js-master-page").length&&$(".js-master-page").on("click",function(){$.ajax({method:"POST",url:"/ajaxPageMaster",data:{_token:token}}).done(function(e){if(!0===e.success){var a=e.route;location.replace(a)}})});var t=300,r=500;if(0<$(".js-profile-editor").length){var e=$(".js-profile__name").val().length;e=t-e,$(".js-countForTextarea").html(+e)}if($(".js-profile-editor").keyup(function(){var e=$(this);e.val().length>t&&e.val(e.val().substr(0,t));var a=$(".js-profile-editor").val().length;a=t-a,$(".js-countForTextarea").html(+a)}),0<$(".js-profile-editor2").length){e=$(".js-profile__name").val().length;e=r-e,$(".js-countForTextarea2").html(+e)}$(".js-profile-editor2").keyup(function(){var e=$(this);e.val().length>r&&e.val(e.val().substr(0,r));var a=$(".js-profile-editor2").val().length;a=r-a,$(".js-countForTextarea2").html(+a)})}),$(document).on("click",".js-ajax-open-preview",function(e){e.stopPropagation();var a=$(this).prev().find(".js-btn-fav").data("favorite"),t=$("#nextPrev").text(),r=JSON.parse("["+t+"]");$.ajax({method:"POST",url:"/ajaxOpenPreviewProduct",data:{productID:a,nextPrev:r,cityAlias:cityAlias,_token:token}}).done(function(e){!0===e.success&&($("#preview").html(e.html),$("#preview").modal(),modalSlider(),sliderRelatedModal(),changeColor(),$(".js-card-tab-related--modal").tabs())}),e.preventDefault()}),$(document).on("click",".js-ajax-open-preview-in-mobile",function(e){e.stopPropagation();var a=$(this).parent().find(".js-btn-fav").data("favorite"),t=$("#nextPrev").text(),r=JSON.parse("["+t+"]");$.ajax({method:"POST",url:"/ajaxOpenPreviewProduct",data:{productID:a,nextPrev:r,cityAlias:cityAlias,_token:token}}).done(function(e){!0===e.success&&($("#preview").html(e.html),$("#preview").modal(),modalSlider(),sliderRelatedModal(),changeColor(),$(".js-card-tab-related--modal").tabs())}),e.preventDefault()}),$(document).on("click",".js-ajax-open-preview-button",function(e){var a=$(this).parent().parent().prev().prev().find(".js-btn-fav").data("favorite"),t=$("#nextPrev").text(),r=JSON.parse("["+t+"]");$.ajax({method:"POST",url:"/ajaxOpenPreviewProduct",data:{productID:a,cityAlias:cityAlias,nextPrev:r,_token:token}}).done(function(e){!0===e.success&&($("#preview").html(e.html),$("#preview").modal(),modalSlider(),sliderRelatedModal(),changeColor(),$(".js-card-tab-related--modal").tabs())}),e.preventDefault()}),$(document).on("click",".js-ajax-open-preview-in-preview",function(e){var a=$(this).data("product"),t=$("#nextPrev").text(),r=JSON.parse("["+t+"]");$.ajax({method:"POST",url:"/ajaxOpenPreviewProduct",data:{productID:a,cityAlias:cityAlias,nextPrev:r,_token:token}}).done(function(e){!0===e.success&&($("#preview").html(e.html),$("#preview").modal(),modalSlider(),sliderRelatedModal(),changeColor(),$(".js-card-tab-related--modal").tabs())}),e.preventDefault()}),$(document).ready(function(){if(0<$(".js-profile-form-edit__main").length){var e=[];e.name=$(".js-profile__name"),e.genderClass=$(".js-profile__gender"),e.genderEntity=$('input[class="js-profile__gender"]:checked'),e.genderBlock=$(".js-profile-gender__block"),e.phone=$(".js-profile__phone"),e.email=$(".js-profile__email"),e.workPlace=$(".js-profile__workPalace"),$(e.name).on("input",function(){return $(this).parent().removeClass("is-invalid"),!1}),$(e.genderClass).on("change",function(){return e.genderEntity=$(this),$(this).parent().parent().removeClass("is-invalid"),!1}),$(e.workPlace).on("change",function(){return e.workPlace=$(this),$(this).parent().parent().removeClass("is-invalid"),!1}),$(e.email).on("input",function(){return $(this).parent().removeClass("is-invalid"),!1}),$(".js-profile-form-submit__main").on("click",function(){return submitMainProfileForm(e),!1}),$(".js-cabinet-phone-confirm").on("click",function(){var a=$(this),e=$(".js-profile__phone").val();return $.ajax({method:"POST",url:"/ajaxSendSms",data:{phone:e,_token:token}}).done(function(e){!0===e.success&&(a.css("display","none").closest(".js-confirm").find(".confirm__timer, .confirm__field").removeAttr("style"),phoneConfirmTimer())}),!1}),$(".js-cabinet-phone-confirm__button").on("click",function(){var e=$("#js-cabinet-phone-confirm__input").val(),a=$("#js-cabinet-phone-confirm__error"),t=$("#js-cabinet-phone-confirm__error-block");return""===e?(t.addClass("is-invalid"),a.text("Введите код из SMS сообщения")):$.ajax({method:"POST",url:"/ajaxConfirmSms",data:{confirmValue:e,updateUser:!0,redirect:!0,_token:token}}).done(function(e){!0===e.success?($(".js-profile-editor__attention-success").removeClass("is-hidden"),$(".js-profile-editor__attention-error").remove(),$("#js-cabinet-phone-confirm__error-block").remove(),$(".js-profile-editor__input-phone").removeClass("is-error").addClass("is-confirm")):(t.addClass("is-invalid"),a.text("Не верный код"))}),!1})}if(0<$(".js-profile-form-edit__contact").length&&($(".js-profile-contact__region").on("change",function(){var e=$(this).val();return $.ajax({method:"POST",url:"/ajaxGetCitiesByRegionID",data:{regionID:e,_token:token}}).done(function(e){if(!0===e.success){var a=$(".js-profile-contact__city"),t=JSON.parse(e.html),r=[{id:0,text:"Не выбран"}];$.each(t,function(e,a){r.push({id:e,text:a})}),a.html("").select2({data:r})}}),!1}),$(".js-profile-form-submit__contact").on("click",function(){return $(".js-profile__success").addClass("is-active"),setTimeout(function(){$(".js-profile-form-edit__contact").submit()},2e3),!1})),0<$(".js-profile-form-edit__security").length){var a=$(".js-profile__password-new"),t=$(".js-profile__password-confirm");a.on("input",function(){return $(this).parent().removeClass("is-invalid"),!1}),t.on("input",function(){return $(this).parent().removeClass("is-invalid"),!1}),$(".js-profile-form-submit__security").on("click",function(){return submitSecurityProfileForm(a,t),!1})}if(0<$(".js-raise-the-profile").length&&$(".js-raise-the-profile").on("click",function(){return $.ajax({method:"POST",url:"/ajaxRaiseTheProfile",data:{_token:token}}).done(function(e){if(!0===e.success){var a=e.itemPosition;$(".js-update-number").text(a+" - я")}}),!1}),0<$(".js-upload-avatar").length){var r={x:0,y:0,width:0,height:0};$(".js-upload-avatar__button").on("change",function(){var e=this.files,t=new FormData;return event.stopPropagation(),event.preventDefault(),void 0===e||($.each(e,function(e,a){t.append(e,a)}),t.append("_token",token),$.ajax({method:"POST",url:"/ajaxPrepareAvatar",data:t,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(e){if(!0===e.success){var a=$(".js-upload-avatar__cropper");$(".js-upload-avatar__block").show(),a.attr("src",e.src),a.attr("data-name",e.fileName),$("#js-upload-avatar").cropper({aspectRatio:1,crop:function(e){r.x=e.x,r.y=e.y,r.width=e.width,r.height=e.height}})}}})),!1}),$(".js-upload-avatar__save").on("click",function(){var e=$(".js-upload-avatar__cropper").data("name"),a=$(".js-upload-avatar__img-block").data("id");r.avatarPath=e,r.currentUserID=a,$.ajax({method:"POST",url:"/ajaxCropAndSaveAvatar",data:{cropParams:JSON.stringify(r),_token:token}}).done(function(e){if(!0===e.success){var a=$(".js-upload-avatar__left-img"),t=$(".js-upload-avatar__left-top");a.attr("src",e.avatar),t.attr("src",e.avatar),updateImage(a),updateImage(t),$(".js-upload-avatar__save").remove(),$.fancybox.close()}})})}if(0<$(".js-cat-services-select__block").length){var n=$(".js-cat-services__div"),s=[];n.each(function(){$(this).hasClass("is-checked")&&s.push($(this).data("id"))}),n.on("click",function(){var e=$(this).data("id"),a=s.indexOf(e);if(-1===a&&s.push(e),$(this).hasClass("is-checked")&&!$(this).hasClass("js-disable-category"))$(this).removeClass("is-checked"),s.splice(a,1);else if($(this).hasClass("is-checked")&&$(this).hasClass("js-disable-category")){$(".js-cat-services-button__remove").attr("data-id",e);var t=$(this).data("title");$.fancybox.open({src:"#disable-category",type:"inline"}),$(".disable-category__data-title").text(t)}else $(this).addClass("is-checked")}),$(document).on("click",".js-cat-services-button__remove",function(){var e=$(this).attr("data-id"),a=s.indexOf(parseInt(e));-1!==a&&s.splice(a,1),$.fancybox.close(),$(".js-cat-item-"+e).removeClass("is-checked").removeClass("js-disable-category")}),$(".js-cat-services-select__button").on("click",function(){return $.ajax({method:"POST",url:"/ajaxAddCategoriesToUser",data:{userID:$(this).data("id"),categoryIDs:JSON.stringify(s),_token:token}}).done(function(e){!0===e.success&&(window.location.href=e.redirect)}),!1})}if(0<$(".js-services-select__block").length){$(".js-service-check__div").on("click",function(){var e=$(this),a=$(this).data("id"),t=$(".js-service-input-block__price-"+a),r=$(".js-service-input-block__time-"+a);e.hasClass("is-checked")?(e.removeClass("is-checked"),t.attr("disabled",""),r.attr("disabled",""),t.parent().removeClass("is-invalid"),r.parent().removeClass("is-invalid"),updateService(a,0)):(e.addClass("is-checked"),t.removeAttr("disabled"),r.removeAttr("disabled"),""===t.val()&&t.parent().addClass("is-invalid"),""===r.val()&&r.parent().addClass("is-invalid"),updateService(a,1))}),$(".service-item__field").on("click",function(){var e=$(this);e.find(".js-service-input").attr("disabled")&&(e.parent(".service-item").children(".js-service-check__div").addClass("is-checked"),e.find(".js-service-input").removeAttr("disabled",""))});var i=$(".js-service-input");i.on("input",function(){$(this).parent().removeClass("is-invalid"),""===$(this).val()&&$(this).parent().addClass("is-invalid")}),i.on("change",function(){var e,a,t=!1,r=$(this);if(r.hasClass("js-i-time")&&""!==r.val()&&""!==r.parent().prev().children(".js-i-price").val()&&(t=!0,e=r.parent().prev().children(".js-i-price").val(),a=r.val()),r.hasClass("js-i-price")&&""!==r.val()&&""!==r.parent().next().children(".js-i-time").val()&&(t=!0,e=r.val(),a=r.parent().next().children(".js-i-time").val()),!0===t){var n=$(this).data("id");$.ajax({method:"POST",url:"/ajaxMasterService",data:{serviceID:$(this).data("id"),price:e,time:a,_token:token}}).done(function(e){if(!0===e.success){var a=$(".js-service-item__save-"+n);a.fadeIn(),setTimeout(function(){a.fadeOut()},1e3)}})}})}0<$(".js-lk-works__block").length&&($(".js-lk-popup-categories__select").on("change",function(){$(this).parent().removeClass("is-invalid");var e=$(this).val();0!==e&&$.ajax({method:"POST",url:"/ajaxSelectServicesByCategoryID",data:{categoryID:e,_token:token}}).done(function(e){if(!0===e.success){var a=$(".js-lk-popup-services__select"),t=JSON.parse(e.html),r=[{id:0,text:"Не выбран"}];$.each(t,function(e,a){r.push({id:e,text:a})}),a.html("").select2({data:r})}})}),$(".js-lk-popup-create-album__button").on("click",function(){var e=$(".js-lk-popup-categories__select"),a=$(".js-lk-popup-services__select"),t=$(".js-lk-popup-album__description"),r=0;if("0"===e.val()?(r++,e.parent().addClass("is-invalid")):e.parent().removeClass("is-invalid"),"0"===a.val()?(r++,a.parent().addClass("is-invalid")):a.parent().removeClass("is-invalid"),0!==r)return!1;$.ajax({method:"POST",url:"/ajaxAddNewAlbum",data:{categoryID:e.val(),serviceID:a.val(),albumDescription:t.val(),_token:token}}).done(function(e){!0===e.success&&(window.location.href=e.redirect)})}),$(".js-lk-popup-services__select").on("change",function(){$(this).parent().removeClass("is-invalid")}),$(".js-lk-popup-album__name").on("input",function(){$(this).parent().removeClass("is-invalid")}));var o=$(".js-delete-album__icon");0<o.length&&o.on("click",function(){$(".js-delete-album__button").attr("data-album",$(this).data("id"))});var c=$(".js-delete-album__button");0<c.length&&c.on("click",function(){var a=$(this).attr("data-album");$.ajax({method:"POST",url:"/ajaxRemoveAlbumFromList",data:{albumID:a,_token:token}}).done(function(e){!0===e.success&&($.fancybox.close(),$(".js-album__block-"+a).remove())})}),0<$(".js-cabinet__map").length&&ymaps.ready(initCabinetMap),$(".js-rotate-file__right").length,0<$(".js-workingEmpty").length&&$(".js-workingEmpty").on("click",function(){0==$(".js-workingEmpty").children().val()?$(".js-workingEmpty").children().val("1"):$(".js-workingEmpty").children().val("0")});var l=$(".js-show-master-in-catalog");0<l.length&&l.on("click",function(){var e;e=$(this).is(":checked")?1:0,$.ajax({method:"POST",url:"/ajaxShowMasterInCatalog",data:{userActive:e,_token:token}}).done(function(e){e.success})});var d=$(".js-delete-add-address");0<d.length&&d.on("click",function(){var a=$(this);return $.ajax({method:"POST",url:"/ajaxDeleteAddAddress",data:{addressID:a.data("address"),_token:token}}).done(function(e){!0===e.success&&a.parent().remove()}),!1});var u=$(".js-step-one-phone-confirm");if(0<u.length){var p=$(".js-step__first-input"),m=$(".js-step-one__confirm");u.on("click",function(){if(entity=$(this),""===p.val())return p.parent().addClass("is-invalid"),!1;$.ajax({method:"POST",url:"/ajaxSendSms",data:{phone:p.val(),_token:token}}).done(function(e){!0===e.success&&(entity.css("display","none").closest(".js-confirm").find(".confirm__timer, .confirm__field").removeAttr("style"),phoneConfirmTimer())})}),p.on("input",function(){$(this).parent().removeClass("is-invalid")}),m.on("click",function(){var e=$("#js-step-one-phone-confirm__input").val(),a=$("#js-step-one-phone-confirm__error"),t=$("#js-step-one-phone-confirm__error-block");return""===e?(t.addClass("is-invalid"),a.text("Введите код из SMS сообщения")):$.ajax({method:"POST",url:"/ajaxConfirmSms",data:{confirmValue:e,updateUser:!0,redirect:!0,phone:p.val(),steps:!0,_token:token}}).done(function(e){!0===e.success?window.location.href=e.steps:(t.addClass("is-invalid"),a.text("Не верный код"))}),!1})}});var balloon={iconLayout:"default#image",iconImageHref:"/templates/beauty/index/img/general/map-pin.svg",iconImageSize:[30,42],iconImageOffset:[-3,-42]};function submitMainProfileForm(i){$.ajax({method:"POST",url:"/ajaxCabinetValidate",data:{phone:i.phone.val(),email:i.email.val(),_token:token}}).done(function(e){var a=0,t=0,r=$(".js-profile__workPalace");if(0<r.length&&(r.each(function(){$(this).is(":checked")&&a++}),0===a&&(i.workPlace.parent().parent().addClass("is-invalid"),t++)),!0!==e.success){var n=JSON.parse(e.errors);n.phone&&(i.phone.parent().addClass("is-invalid"),i.phone.next().text(n.phone)),n.email&&(i.email.parent().addClass("is-invalid"),i.email.next().text(n.email)),t++}if(0===t)console.log(1),setTimeout(function(){$(".js-profile-form-edit__main").submit()},100);else if($(window).width()<=768){console.log(2);var s=$(".profile-editor__input.is-invalid").offset().top;$("body,html").animate({scrollTop:s-37},400)}return!1})}function submitSecurityProfileForm(e,a){var t=0;return(""===e.val()||e.val().length<6)&&(e.parent().addClass("is-invalid"),e.next().next().next().text("Пароль короче 6 символов"),t++),""===a.val()&&(a.parent().addClass("is-invalid"),a.next().next().next().text("Повторите новый пароль"),t++),e.val()!==a.val()&&(a.parent().addClass("is-invalid"),a.next().next().next().text("Пароли не совпадают"),t++),0<t||($(".js-profile__success").addClass("is-active"),setTimeout(function(){$(".js-profile-form-edit__security").submit()},2e3)),!1}function updateImage(e){e.attr("src",e.attr("src").split("?")[0]+"?"+(new Date).getTime())}function updateService(t,e){$.ajax({method:"POST",url:"/ajaxMasterServiceUpdate",data:{serviceID:t,status:e,_token:token}}).done(function(e){if(!0===e.success){var a=$(".js-service-item__save-"+t);a.fadeIn(),setTimeout(function(){a.fadeOut()},1e3)}})}function initCabinetMap(){var t,r,e,a,n=$("#coordX"),s=$("#coordY");""===n.val()&&""===s.val()?(e=55.742909,a=37.6275):(e=n.val(),a=s.val()),t=new ymaps.Map("card-map",{center:[e,a],zoom:17}),r=new ymaps.Placemark([e,a],{},balloon),t.events.add("click",function(e){var a=e.get("coords");n.val(a[0]),s.val(a[1]),t.geoObjects.remove(r),r=new ymaps.Placemark([a[0],a[1]],{},balloon),t.geoObjects.add(r)}),t.controls.remove("typeSelector"),t.geoObjects.add(r),$(".js-profile-contact__city").on("change",function(){var e=$(this).val();return $.ajax({method:"POST",url:"/ajaxGetMetroOrDistrict",data:{cityID:e,_token:token}}).done(function(e){if(!0===e.success){var a,t=e.type,r=$(".js-profile-contact__metro-block"),n=$(".js-profile-contact__district-block");if("metro"===t&&(r.removeClass("is-hidden"),n.addClass("is-hidden"),a=$(".js-profile-contact__metro")),"district"===t&&(n.removeClass("is-hidden"),r.addClass("is-hidden"),a=$(".js-profile-contact__district")),""===t)n.addClass("is-hidden"),r.addClass("is-hidden");else{var s=JSON.parse(e.html),i=[{id:0,text:"Не выбран"}];$.each(s,function(e,a){i.push({id:e,text:a})}),a.html("").select2({data:i})}var o=$(".js-profile-contact__home").val(),c=$(".js-profile-contact__number").val();""===o&&(o=null),""===c&&(c=null),geoMap(e.cityName,o,c)}}),!1}),$(document).on("keyup",".js-profile-contact__home",function(){var e=$(".js-profile-contact__city").find("option:selected").text(),a=$(".js-profile-contact__number").val();""===a&&(a=null),geoMap(e,$(this).val(),a)}),$(document).on("keyup",".js-profile-contact__number",function(){var e=$(".js-profile-contact__city").find("option:selected").text(),a=$(".js-profile-contact__home").val();""===a&&(a=null),geoMap(e,a,$(this).val())})}function geoMap(e,a,t){var r,n,s,i,o="";(o=null!==e&&null!==a&&null!==t?ymaps.geocode(e+", "+a+", "+t):null!==e&&null!==a?ymaps.geocode(e+", "+a):null!==e?ymaps.geocode(e):ymaps.geocode("Москва")).then(function(e){var a=e.geoObjects.get(0).geometry.getCoordinates();o.then(function(e){$("#card-map").html(""),s=a[0],i=a[1],r=new ymaps.Map("card-map",{center:[s,i],zoom:17}),$("#coordX").attr("value",s),$("#coordY").attr("value",i),n=new ymaps.Placemark([s,i],{},balloon),r.geoObjects.add(n),r.events.add("click",function(e){var a=e.get("coords");$("#coordX").attr("value",a[0]),$("#coordY").attr("value",a[1]),r.geoObjects.remove(n),n=new ymaps.Placemark([a[0],a[1]],{},balloon),r.geoObjects.add(n)})})})}function generateHtmlCategory(e,a,t){return html='<li class="js-category-item-'+e+' category__item"> <a class="category__link" href="#">',html+=a,html+='<span class="category__price">'+number_format(t,0," "," ")+' <i class="fa fa-rub"></i></span>',html+='</a><span class="category__icon js-category--reset" data-id="'+e+'"></span>',html+="</li>",html}function countServices(){var e=$(".js-service-count"),a=$(".js-service-price"),t=0,r=0;$(".card-services-item.is-booked").each(function(){r+=parseInt($(this).data("price")),t+=1}),e.attr("data-count",t),a.html(number_format(r,0," "," ")+' <i class="fa fa-rub"></i>')}function countServicesIDs(e,a){var t=a.indexOf(e);return-1<t?a.splice(t,1):a.push(e),a}function sendOrder(){var a=$(".js-service-price").text();$.ajax({method:"POST",url:"/submitNewRequest",data:{order:localStorage.getItem("orderToMaster"),_token:token}}).done(function(e){!0===e.success&&($(".js-order-main-form").addClass("is-success"),fbq("track","AddToCart",{content_name:"Заявка",value:a,currency:"RUB"}))})}function initCardMap(){var e,a,t,r=$(".js-card__map"),n=r.data("x"),s=r.data("y");e=new ymaps.Map("card-map",{center:[n,s],zoom:15}),t={iconLayout:"default#image",iconImageHref:"/templates/beauty/index/img/general/map-pin.svg",iconImageSize:[30,42],iconImageOffset:[-3,-42]},a=new ymaps.Placemark([n,s],{},t),e.controls.remove("typeSelector"),e.geoObjects.add(a)}function updateOrderInfo(e,a,t,r,n){var s=t.price,i=s*e;if(0<$(".js-order-cart-page").length){var o=n.parent().parent().next(),c=n.parent().parent().prev(),l=n.parent().find(".js-arr-final-data"),d=n.parent().find(".js-type-product").val(),u=n.parent().find(".js-current-price-int"),p=number_format(i,2,"."," ")+"<span>  руб.</span>";o.html(p),u.val(i),getAllProductsSum()}else{o=$(".js-card__order-info"),c=$(".js-card__price"),l=$(".js-arr-final-data");var m=JSON.parse(a.val())[0].count;if(1==(d=$(".js-type-product").val())){if(m<=e){p="В корзине <span>"+e+"</span> метров — <span>"+number_format(i,2,"."," ")+"</span> руб.";o.html(p)}}else if(m<=e){p="В корзине <span>"+e+"</span> шт — <span>"+number_format(i,2,"."," ")+"</span> руб.";o.html(p)}}if(1==d)var h=number_format(s,2,"."," ")+" <span>руб/м</span>";else h=number_format(s,2,"."," ")+" <span>руб/шт</span>";t.count=e,l.val(JSON.stringify(t)),t.discount?h=h+"<small>-"+t.discount+"%</small>":t.discount=null,c.html(h),$.ajax({method:"POST",url:"/ajaxAddProductToCart",data:{productID:r,arrData:JSON.stringify(t),onlyData:!0,_token:token}})}function checkStep(t,e){var r={};return $.each(JSON.parse(e.val()),function(e,a){null!==a.count&&t>=a.count&&(null!==a.discount&&(r.discount=a.discount),r.price=a.price)}),r}function changeInput(e){var a=e,t=a,r=parseInt(t.val()),n=a.parent().find(".js-type-product").val(),s=a.parent().find(".js-arr-prices"),i=a.parent().find(".js-arr-prices").data("id"),o=JSON.parse(s.val())[0].count,c="",l=0;c=1==n?" м":" шт",a.parent().find(".item-select__title").hide(),l=isNaN(r)?o:r<o?o:r,t.show().val(l+c),updateOrderInfo(l,s,checkStep(l,s),i,a)}function getAllProductsSum(){var t=0;$(".js-current-price-int").each(function(){var e=$(this),a=parseFloat(e.val());t+=a}),$(".js-cart__sum_current").text(number_format(t,2,"."," "))}function auto_layout_keyboard(e){return replacer={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."},e.replace(/[A-z/,.;\'\]\[]/g,function(e){return e==e.toLowerCase()?replacer[e]:replacer[e.toLowerCase()].toUpperCase()})}function number_format(e,a,t,r){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var n,s,i,o=isFinite(+e)?+e:0,c=isFinite(+a)?Math.abs(a):0,l=void 0===r?",":r,d=void 0===t?".":t,u="";return 3<(u=(c?(n=o,s=c,i=Math.pow(10,s),""+Math.round(n*i)/i):""+Math.round(o)).split("."))[0].length&&(u[0]=u[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,l)),(u[1]||"").length<c&&(u[1]=u[1]||"",u[1]+=new Array(c-u[1].length+1).join("0")),u.join(d)}function phoneConfirmTimer(){var r=$(".js-timer");!function t(){setTimeout(function(){var e=r.data("timer");r.text(e);var a=setInterval(function(){-1==--e?(clearInterval(a),r.parent().css("display","none"),$(".js-cabinet-phone-confirm").removeAttr("style")):r.text(e)},1e3);$(".js-cabinet-phone-confirm").on("click",function(e){clearInterval(a),t()})})}()}function addFavorite(e){var a=localStorage.getItem("favorite"),t=e;$.ajax({method:"POST",url:"/ajaxAddFavorite",data:{favorite:a,userID:t,_token:token}}).done(function(e){e.success})}function ajaxPhoneShow(){$(".js-user-phone--show").trigger("click")}function ajaxReviewsAdd(e,a){$.fancybox.open($("#review-add")),$(".review-add__title").html(e),$(".reviews__header").attr("data-from",a)}function redirectToCabinet(){$.ajax({method:"POST",url:"/ajaxRedirectToCabinet",data:{_token:token}}).done(function(e){if(!0===e.success){var a=e.route;location.replace(a)}})}function getCity(){$(".js-search-alias__input").val(cityAlias)}function generateHtmlBlockMetro(e,a){var t='<li class="metro-checked__item">';return t+=e,t+='<i class="fa fa-times js-metro-delete__icon metro-checked__icon" data-id="'+a+'"></i>',t+="</li>"}function generateHtmlBlockDistrict(e,a){var t='<li class="metro-checked__item">';return t+=e,t+='<i class="fa fa-times js-district-delete__icon metro-checked__icon" data-id="'+a+'"></i>',t+="</li>"}function generateUrlArray(){var s=[],e=window.location.search.substring(1).split("&");return""!=e&&$.each(e,function(e,a){var t,r,n=a.split("=");t=n[0],r=n[1],s[t]=r}),s}function updateUrlArray(e,a,t,r,n){n=n||!1;if(e[a]){var s=e[a];if(""!=(s=s.toString())&&-1!==s.indexOf(",")){var i=e[a].split(",");if("add"===r){var o=0;$.each(i,function(e,a){a===t&&o++}),0===o&&(e[a]=e[a]+","+t)}"delete"===r&&($.each(i,function(e,a){a==t&&i.splice(e,1)}),e[a]=i.join(","))}if(""!=s&&-1===s.indexOf(",")){i=e[a];"add"===r&&(n?e[a]=t:i!=t&&(e[a]=e[a]+","+t)),"delete"===r&&i==t&&delete e[a]}}else e[a]=t;return e}function generateStingFromArray(a){var t="?";return Object.keys(a).forEach(function(e){t="?"==t?t+e+"="+a[e]:t+"&"+e+"="+a[e]}),t}function ajaxFilter(){location.pathname.split("/")[1]?(nameFilter=location.pathname.split("/")[1],location.pathname.split("/")[2]?nameType=location.pathname.split("/")[2]:nameType=""):(nameFilter="",nameType=""),$.ajax({method:"POST",url:"/ajaxAddContent",data:{cityID:cityID,cityAlias:$(".js-catalog__city-breadcrumbs").data("alias"),globalParams:JSON.stringify(window.location.search.substring(1).split("&")),categoryID:$(".js-catalog-filter__category").data("category"),nameFilter:nameFilter,nameType:nameType,_token:token}}).done(function(e){!0===e.success&&($(".js-product-item__wrap").html(e.html),$(".js-count-masters").text(e.countProducts),0===e.countProducts?$(".js-catalog-empty").removeClass("is-hidden"):$(".js-catalog-empty").addClass("is-hidden"),$("#nextPrev").html(e.arrNextPrev),$("html, body").animate({scrollTop:0},800))})}function ajaxAddContent(e,a){location.pathname.split("/")[1]?(nameFilter=location.pathname.split("/")[1],location.pathname.split("/")[2]?nameType=location.pathname.split("/")[2]:nameType=""):(nameFilter="",nameType=""),$(".js-loader__scroll").removeClass("is-hidden"),$(".product-item").each(function(){e++}),$.ajax({method:"POST",url:"/ajaxAddContent",data:{cityID:cityID,cityAlias:$(".js-catalog__city-breadcrumbs").data("alias"),globalParams:JSON.stringify(window.location.search.substring(1).split("&")),categoryID:$(".js-catalog-filter__category").data("category"),skip:e,nameFilter:nameFilter,nameType:nameType,allCountMasters:a,_token:token}}).done(function(e){if(!0===e.success){var a=$(".js-loader__scroll");a.addClass("is-hidden"),$(".js-product-item__wrap").append(e.html),(0===e.countProducts||e.countProducts<e.countCatalog)&&a.addClass("the-end")}})}function addMastersToContent(e,a,t,r){$(window).scroll(function(){checkVisibility(t)||(a=0),0===a&&(checkVisibility(t)?(a=1,$(".js-loader__scroll").hasClass("the-end")||ajaxAddContent(e,r)):a=0)})}function sendAjax(){$(".js-loader__scroll").removeClass("the-end"),480<=$(window).width()&&ajaxFilter()}function checkVisibility(e){var a=$(window).scrollTop(),t=a+$(window).height(),r=$(e).offset().top;$(e).height();return r<=t&&a<=r}function getUrlVars(){for(var e,a=[],t=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),r=0;r<t.length;r++)e=t[r].split("="),a.push(e[0]),a[e[0]]=e[1];return a}$(document).ready(function(){if(0<$(".card__content_inner").length){var c=[],t={},l=$(".js-order-main-block"),r={},n=$("#js-order-date-input"),s=$("#js-order-timeFrom-select"),i=$("#js-order-phone-input");$(".js-card-services-item").on("click",function(e){if(!$(e.target).closest(".card-services-item__middle").length&&!$(e.target).closest(".card-services-item__info-block").length){if(l.hasClass("is-disabled"))return!1;l.hasClass("is-booked")||l.addClass("is-booked");var a=$(this),t=a.find(".card-services-item__action_add"),r=a.find(".card-services-item__action_done"),n=$(".js-categories-block"),s=a.data("id"),i=a.data("name"),o=a.data("price");c=countServicesIDs(s,c),a.hasClass("is-booked")?($(".js-category-item-"+s).remove(),a.removeClass("is-booked"),t.removeAttr("style"),r.removeAttr("style")):($(".js-empty-services-count").addClass("is-hidden"),n.append(generateHtmlCategory(s,i,o)),a.addClass("is-booked"),fbq("track","InitiateCheckout"),fbq("trackCustom","Добавление услуги",{"Название":i}),t.css("display","none"),r.css("display","block")),countServices()}}),$(document).on("click",".js-category--reset",function(){if(l.hasClass("is-disabled"))return!1;var e=$(this).data("id"),a=$(".js-card-service-block-"+e),t=a.find(".card-services-item__action_add"),r=a.find(".card-services-item__action_done");c=countServicesIDs(e,c),a.removeClass("is-booked"),t.removeAttr("style"),r.removeAttr("style"),countServices(),$(this).parent().remove()}),$(".js-card-request--show").on("click",function(){if(l.hasClass("is-booked")){var e=0;if(n.parent().removeClass("is-invalid"),i.parent().removeClass("is-invalid"),$(window).width()<=768?$(this).addClass("is-attention"):0===c.length&&($(".js-empty-services-count").removeClass("is-hidden"),e++),""===n.val()&&(n.parent().addClass("is-invalid"),e++),""===i.val()&&(i.parent().addClass("is-invalid"),e++),0<e)return!1;l.addClass("is-disabled");var a=n.val();a=(a=a.split("."))[2]+"."+a[1]+"."+a[0],t.phone=i.val(),t.date=a,t.timeFrom=s.val(),t.masterID=$("#js-card-user__name").data("id"),r.data=t,r.services=c,localStorage.setItem("orderToMaster",JSON.stringify(r)),$.ajax({method:"POST",url:"/ajaxCheckUserForConfirm",data:{phone:i.val(),_token:token}}).done(function(e){return!1===e.success&&!0===e.authForm?(localStorage.setItem("cardRoute","true"),$.fancybox.open($(".header-action__login")),!1):!1===e.success&&!0===e.confirmPhoneBlock?($(".js-order-main-form").addClass("is-confirm"),!1):!1===e.success&&!0===e.phoneError?(i.parent().addClass("is-invalid"),i.next().text("Пользователь с таким номером уже существут"),l.removeClass("is-disabled"),!1):!0===e.success?(sendOrder(),!1):void 0})}else l.addClass("is-booked");return!1}),$(".js-sms-confirm-button__order").on("click",function(){var e=$("#js-sms-confirm-input__order").val(),a=$("#js-sms-confirm-error__order");return""==e?a.show().text("Введите код из SMS сообщения"):$.ajax({method:"POST",url:"/ajaxConfirmSms",data:{confirmValue:e,updateUser:!0,_token:token}}).done(function(e){!0===e.success?sendOrder():a.show().text("Не верный код")}),!1}),0<$(".js-card__map").length&&ymaps.ready(initCardMap)}}),$(document).ready(function(){$(document).on("click",".js-product-add-to-cart",function(e){e.preventDefault();var a=$(this),t=a.data("id");$.ajax({method:"POST",url:"/ajaxAddProductToCart",data:{productID:t,count:1,_token:token}}).done(function(e){!0===e.success&&($(".js-user-nav__item--cart").attr("data-cart-counter",e.productCount),pushUp(),a.hide(),a.next().removeClass("is-hidden"))})}),$(document).on("click",".js-product-add-to-cart-more",function(e){e.preventDefault();var l=$(this),a=l.data("id"),t=$(".js-arr-final-data").val();$.ajax({method:"POST",url:"/ajaxAddProductToCart",data:{productID:a,arrData:t,_token:token}}).done(function(e){if(!0===e.success){$(".js-user-nav__item--cart").attr("data-cart-counter",e.productCount),pushUp(),l.addClass("is-hidden"),l.next().removeClass("is-hidden");var a=JSON.parse(e.arrData),t=$(".js-cart-count"),r=$(".js-card__order-info"),n=$(".js-card__price"),s=l.parent().parent().prev().find(".js-type-product").val(),i=(n=$(".js-card__price"),a.count*a.price);if(1==s){var o="В корзине <span>"+a.count+"</span> метров — <span>"+number_format(i,2,"."," ")+"</span> руб.";t.show().val(a.count+" м");var c=number_format(a.price,2,"."," ")+" <span>руб/м</span>"}else{o="В корзине <span>"+a.count+"</span> шт — <span>"+number_format(i,2,"."," ")+"</span> руб.";t.show().val(a.count+" шт");c=number_format(a.price,2,"."," ")+" <span>руб/шт</span>"}a.discount&&(c=c+"<small>-"+a.discount+"%</small>"),n.html(c),r.html(o),t.prev().hide()}})}),$(document).on("click",".js-cart-plus",function(e){e.preventDefault(),e.stopPropagation();var a=$(this),t=a.parent().find(".js-cart-count"),r=parseInt(t.val()),n=a.parent().find(".js-type-product").val(),s=a.parent().find(".js-arr-prices"),i=a.parent().find(".js-arr-prices").data("id"),o=JSON.parse(s.val())[0].count,c="",l=0;c=1==n?" м":" шт",a.parent().find(".item-select__title").hide(),isNaN(r)?l=o:(r<o&&(l=o),o<=r&&(l=r+1)),t.show().val(l+c),updateOrderInfo(l,s,checkStep(l,s),i,a)}),$(document).on("click",".js-cart-minus",function(e){e.preventDefault(),e.stopPropagation();var a=$(this),t=a.parent().find(".js-cart-count"),r=parseInt(t.val()),n=a.parent().find(".js-type-product").val(),s=a.parent().find(".js-arr-prices"),i=a.parent().find(".js-arr-prices").data("id"),o=JSON.parse(s.val())[0].count,c="",l=0;if(c=1==n?" м":" шт",a.parent().find(".item-select__title").hide(),isNaN(r))l=o;else{if(r===o)return!1;o<r&&(l=r-1)}t.show().val(l+c),updateOrderInfo(l,s,checkStep(l,s),i,a)}),$(document).on("change",".js-cart-count",function(e){e.preventDefault(),e.stopPropagation(),changeInput($(this))}),$(document).on("click",".js-item-select__item",function(e){changeInput($(this).parent().prev().find(".js-cart-count"))}),$(document).on("click",".js-delete-from-cart__more",function(){var t=$(this),e=$(this).data("id");return $.ajax({method:"POST",url:"/ajaxDeleteProductFromCart",data:{productID:e,_token:token}}).done(function(e){if(!0===e.success){$(".js-card__order-info").html("");var a=$(".js-cart-count");a.prev().show(),a.hide().val(""),pushUp("Товар удален из корзины"),t.parent().addClass("is-hidden"),$(".js-product-add-to-cart-more").removeClass("is-hidden"),$(".js-user-nav__item--cart").attr("data-cart-counter",e.productCount),$(".js-item-count-cart").text(e.productCount)}}),!1}),$(document).on("click",".js-delete-from-cart__order",function(){var a=$(this),e=$(this).data("id");return $.ajax({method:"POST",url:"/ajaxDeleteProductFromCart",data:{productID:e,_token:token}}).done(function(e){!0===e.success&&(pushUp("Товар удален из корзины"),a.closest(".product-item").remove(),$(".js-user-nav__item--cart").attr("data-cart-counter",e.productCount),$(".js-item-count-cart").text(e.productCount),getAllProductsSum())}),!1});var l=$(".js-send-order__button");0<l.length&&l.on("click",function(){var e=$(".js-order__name"),a=$(".js-order__lastName"),t=$(".js-order__phone"),r=$(".js-order__email"),n=$(".js-order__city"),s=$(".js-order__zip"),i=$(".js-order__street"),o=$(".js-order__house"),c=($(".js-order__police"),0);return $(".js-order-input").on("input",function(){$(this).parent().removeClass("is-invalid")}),""===e.val()&&(e.parent().addClass("is-invalid"),c++),""===t.val()&&(t.parent().addClass("is-invalid"),c++),""===n.val()&&(n.parent().addClass("is-invalid"),c++),""===s.val()&&(s.parent().addClass("is-invalid"),c++),""===i.val()&&(i.parent().addClass("is-invalid"),c++),""===o.val()&&(o.parent().addClass("is-invalid"),c++),0<c||($("#preloaderSend").removeClass("is-hidden"),l.attr("disabled","disabled"),$.ajax({method:"POST",url:"/ajaxSendOrder",data:{name:e.val(),lastName:a.val(),phone:t.val(),email:r.val(),city:n.val(),zip:s.val(),street:i.val(),house:o.val(),_token:token}}).done(function(e){!0===e.success&&($("#preloaderSend").addClass("is-hidden"),l.removeAttr("disabled"),$(".js-order__form").addClass("is-success"),$(".js-cart-title").remove(),$(".js-cart-items").remove(),$(".js-cart-items__info").remove(),$(".js-user-nav__item--cart").attr("data-cart-counter",0))})),!1})}),$(document).ready(function(){var e=$(".bb-upload__loader");if($(document).ajaxStart(function(){0<e.length&&e.show()}),$(document).ajaxStop(function(){0<e.length&&e.hide()}),0<$(".js-contact__map").length&&ymaps.ready(function(){var e,a,t,r=$(".js-contact__map"),n=r.data("x"),s=r.data("y");e=new ymaps.Map("card-map",{center:[n,s],zoom:15}),t={iconLayout:"default#image",iconImageHref:"/templates/bazar/index/img/general/map-pin.svg",iconImageSize:[30,42],iconImageOffset:[-3,-42]},a=new ymaps.Placemark([n,s],{},t),e.controls.remove("typeSelector"),e.geoObjects.add(a)}),localStorage.setItem("orders",123),localStorage.removeItem("cardRoute"),0<$("#js-main-auth-form").length){$(".js-main-auth-form-block");$("#js-login-account").on("click",function(){var a=$("#js-main-input-email").val(),t=$("#js-main-input-password").val(),r=$("#js-main-input-remember").val(),n=$("#js-auth-error");return $.ajax({method:"POST",url:"/ajaxValidateMainAuth",data:{email:a,password:t,_token:token}}).done(function(e){if(!0===e.success){if(!0===e.userExist){if($(".js-header-profile-block").html(e.html),$(".js-header-profile-block-favorite").html(e.favorite),$(".modal__btn--close").trigger("click"),!0===e.addFavoriteFirstAuth)addFavorite(e.user);return!1}$.ajax({method:"POST",url:"/ajaxRegisterUserByEmail",data:{email:a,password:t,remember:r,_token:token}}).done(function(e){!0===e.success&&($(".js-header-profile-block").html(e.html),$(".js-header-profile-block-favorite").html(e.favorite),$(".modal__btn--close").trigger("click"))})}else n.show().html(e.text)}),!1})}if($(document).on("click",".js-btn-fav",function(e){var a=$(this);if(e.stopPropagation(),a.hasClass("is-checked")){a.removeClass("is-checked");var t=$(this).data("favorite");return localStorage.setItem("favorite",t),$.ajax({method:"POST",url:"/ajaxDeleteFavorite",data:{favorite:t,userID:userID,_token:token}}).done(function(e){1==e.success&&console.log("Удален из избранного")}),!1}t=$(this).data("favorite");return a.addClass("is-checked"),$.ajax({method:"POST",url:"/ajaxAddFavorite",data:{favorite:t,userID:userID,_token:token}}).done(function(e){if(!1===e.success&&!0===e.authForm)return $("#auth-form").modal(),!1;1==e.success&&console.log("Добавлен в изранное")}),!1}),0<$(".js-ajax-show-phone").length&&$(document).on("click",".js-ajax-show-phone",function(){$(this).addClass("js-user-phone--show"),localStorage.setItem("cardRoute","true"),$.ajax({method:"POST",url:"/ajaxPhoneShow",data:{_token:token}}).done(function(e){if(!1===e.success&&!0===e.authForm)return $.fancybox.open($(".header-action__login")),!1})}),0<$(".ajax-reviews-add").length&&$(document).on("click",".ajax-reviews-add",function(){localStorage.setItem("cardRoute","true"),$.ajax({method:"POST",url:"/ajaxReviewsAdd",data:{_token:token}}).done(function(e){return!1===e.success&&!0===e.authForm?($.fancybox.open($(".header-action__login")),!1):!0===e.success?($.fancybox.open($("#review-add")),!1):void 0})}),0<$(".js-search__form").length){var c,s=$(".js-search-input__cities"),l=$(".js-search-input__category"),i=$(".js-search-group__cities"),d=$(".js-search-group__categories"),o=$(".js-search-hint__cities"),u=$(".js-search-hint__category");l.on("keyup",function(e){var a=u.find(".is-selected");if(13===e.keyCode){var t=$(".js-search-category__input"),r=$(".js-search-service__input");if(0<a.find(".js-search-input__link-category").length){var n=a.find(".js-search-input__link-category");c=n.data("name");var s=n.data("category");t.val(""),r.val(""),l.val(c),t.val(s),u.hide()}else if(0<a.find(".js-search-input__link-service").length){var i=a.find(".js-search-input__link-service");c=i.data("name");var o=i.data("service");t.val(""),r.val(""),l.val(c),r.val(o),u.hide()}l.attr("onkeydown",!0),$("#searchCategory").trigger("click")}else 40===e.keyCode?a.html()===a.find("li:last-child").html()?(a.removeClass("is-selected"),d.find("li:first-child").addClass("is-selected")):(a.removeClass("is-selected"),a.next().addClass("is-selected")):38===e.keyCode?a.html()===a.find("li:first-child").html()?(a.removeClass("is-selected"),d.find("li:last-child").addClass("is-selected")):(a.removeClass("is-selected"),a.prev().addClass("is-selected")):""!==$(this).val()?$.ajax({method:"POST",url:"/ajaxSearchCategory",data:{catQuery:$(this).val(),_token:token}}).done(function(e){!0===e.success&&(u.show(),d.html("").prepend(e.html))}):u.hide()}),s.on("keyup",function(e){var a=o.find(".is-selected");if(13===e.keyCode){s.attr("onkeydown",!0);var t=a.find("a").data("alias");$(".js-search-alias__input").val(t),$("#searchCity").trigger("click")}else if(40===e.keyCode)a.html()===o.find("li:last-child").html()?(a.removeClass("is-selected"),i.find("li:first-child").addClass("is-selected")):(a.removeClass("is-selected"),a.next().addClass("is-selected"));else if(38===e.keyCode)a.html()===o.find("li:first-child").html()?(a.removeClass("is-selected"),i.find("li:last-child").addClass("is-selected")):(a.removeClass("is-selected"),a.prev().addClass("is-selected"));else{var r=auto_layout_keyboard($(this).val());$(this).val(r);var n=auto_layout_keyboard($(this).val());""!==n?$.ajax({method:"POST",url:"/ajaxSearchCity",data:{cityName:n,mobile:$(this).data("mobile"),_token:token}}).done(function(e){!0===e.success&&(o.show(),i.html("").prepend(e.html),i.find("li:first-child").addClass("is-selected"))}):o.hide()}}),$(document).on("click",".js-search-input__link",function(){var e=$(this).data("name"),a=$(this).data("alias");s.val(e),$(".js-search-alias__input").val(a),$("#searchCity").trigger("click"),o.hide()}),$(document).on("click",".js-search-input__link-category",function(){var e=$(".js-search-category__input"),a=$(".js-search-service__input"),t=($(".js-search-alias__input"),$(this).data("name")),r=$(this).data("category");return e.val(""),a.val(""),l.val(t),e.val(r),u.hide(),l.attr("onkeydown",!0),$("#searchCategory").trigger("click"),!1}),$(document).on("click",".js-search-input__link-service",function(){var e=$(".js-search-category__input"),a=$(".js-search-service__input"),t=$(this).data("name"),r=$(this).data("service");return e.val(""),a.val(""),l.val(t),a.val(r),u.hide(),l.attr("onkeydown",!0),$("#searchCategory").trigger("click"),!1})}var r=$(".js-password-recover__success-block"),a=$(".js-password-recover__phone-button");if(0<a.length){var n=$(".js-password-recover__phone-input");n.on("input",function(){$(this).parent().removeClass("is-invalid")}),a.on("click",function(){var a=$(".js-password-recover__phone-input-error"),t=$(".js-password-recover__phone-success-text");return""===n.val()?(n.parent().addClass("is-invalid"),a.text("Введите телефон")):$.ajax({method:"POST",url:"/ajaxResetPasswordByPhone",data:{phone:n.val(),_token:token}}).done(function(e){!0===e.success?(r.addClass("is-success--phone"),t.text(n.val())):(n.parent().addClass("is-invalid"),a.text("Неверный телефон"))}),!1})}var t=$(".js-password-recover__email-button");if(0<t.length){var p=$(".js-password-recover__email-input");p.on("input",function(){$(this).parent().removeClass("is-invalid")}),t.on("click",function(){var a=$(".js-password-recover__email-input-error"),t=$(".js-password-recover__email-success-text");return""===p.val()?(p.parent().addClass("is-invalid"),a.text("Введите e-mail")):$.ajax({method:"POST",url:"/ajaxSendPasswordResetLink",data:{email:p.val(),_token:token}}).done(function(e){!0===e.success?(r.addClass("is-success"),t.text(p.val())):(p.parent().addClass("is-invalid"),a.text("Неверный e-mail адрес"))}),!1})}var m=$(".js-password-reset__passwords-button");if(0<m.length){var h=$(".js-password-reset__password-input-error"),v=$(".js-password-reset__password-confirm-input-error"),f=$(".js-password-reset__password-input"),_=$(".js-password-reset__password-confirm-input"),j=$(".js-password-recover__token");f.on("input",function(){$(this).parent().removeClass("is-invalid")}),_.on("input",function(){$(this).parent().removeClass("is-invalid")}),m.on("click",function(){return""===f.val()?(f.parent().addClass("is-invalid"),h.text("Введите новый пароль")):f.val().length<6?(f.parent().addClass("is-invalid"),h.text("Пароль не должен быть короче 6 символов")):""===_.val()?(_.parent().addClass("is-invalid"),v.text("Повторите пароль")):_.val()!==f.val()?(_.parent().addClass("is-invalid"),v.text("Пароли не совпадают")):$.ajax({method:"POST",url:"/ajaxResetPassword",data:{password:f.val(),hiddenToken:j.val(),_token:token}}).done(function(e){!0===e.success&&$(".js-password-reset__success-block").addClass("is-success")}),!1})}if(0<$(".js-contacts__form").length){var g=$(".js-contacts__name"),k=$(".js-contacts__phone"),y=$(".js-contact__email"),x=$(".js-contact__message");$(".js-contacts__form-submit").on("click",function(){var e=0;return""===g.val()&&(g.parent().addClass("is-invalid"),e++),""===k.val()&&(k.parent().addClass("is-invalid"),e++),""===y.val()&&(y.parent().addClass("is-invalid"),e++),""===x.val()&&(x.parent().addClass("is-invalid"),e++),0!==e||$.ajax({method:"POST",url:"/ajaxSendContactForm",data:{name:g.val(),phone:k.val(),email:y.val(),message:x.val(),_token:token}}).done(function(e){!0===e.success&&$(".js-contacts__success").addClass("is-active")}),!1})}}),$(document).ready(function(){if(0<$(".js-catalog-filter").length){var s=generateUrlArray();if(addMastersToContent(0,0,$("#js-seo-text-block"),$(".js-catalog-count-masters").data("count")),$("#js-filter-metro").on("change",function(){var e,a,t=$(this).val(),r=$(this).next().text();$(".js-metro-on").append(generateHtmlBlockMetro(r,t)),a=updateUrlArray(s,"metro",t,"add"),e=generateStingFromArray(s=a),window.history.replaceState("url","",e),sendAjax()}),$("#js-filter-district").on("change",function(){var e,a,t=$(this).val(),r=$(this).text();$(".js-district-on").append(generateHtmlBlockDistrict(r,t)),a=updateUrlArray(s,"district",t,"add"),e=generateStingFromArray(s=a),window.history.replaceState("url","",e),sendAjax()}),$(document).on("change",".js-filter-service",function(){var e,a,t=$(this).data("id");a=$(this).hasClass("is-checked")?updateUrlArray(s,"service",t,"add"):updateUrlArray(s,"service",t,"delete"),e=generateStingFromArray(s=a),window.history.replaceState("url","",e),768<$(window).width()&&sendAjax()}),$(document).on("change",".js-filter-color",function(){var e,a,t=$(this).data("color");a=$(this).hasClass("is-checked")?updateUrlArray(s,"color",t,"add"):updateUrlArray(s,"color",t,"delete"),e=generateStingFromArray(s=a),window.history.replaceState("url","",e),768<$(window).width()&&sendAjax()}),$(document).on("change",".js-filter-country",function(){var e,a,t=$(this).data("country");a=$(this).hasClass("is-checked")?updateUrlArray(s,"countries",t,"add"):updateUrlArray(s,"countries",t,"delete"),e=generateStingFromArray(s=a),window.history.replaceState("url","",e),768<$(window).width()&&sendAjax()}),$(document).on("change",".js-filter-cloth",function(){var e,a,t=$(this).data("cloth");a=$(this).hasClass("is-checked")?updateUrlArray(s,"cloth",t,"add"):updateUrlArray(s,"cloth",t,"delete"),e=generateStingFromArray(s=a),window.history.replaceState("url","",e),768<$(window).width()&&sendAjax()}),$(document).on("click",".js-metro-delete__icon",function(){var e,a,t=$(this).data("id");$(this).parent().remove(),a=updateUrlArray(s,"metro",t,"delete"),e=generateStingFromArray(s=a),window.history.pushState("url","",e),sendAjax()}),$(document).on("click",".js-district-delete__icon",function(){var e,a,t=$(this).data("id");$(this).parent().remove(),a=updateUrlArray(s,"district",t,"delete"),e=generateStingFromArray(s=a),window.history.pushState("url","",e),sendAjax()}),0<$(".category__list").length&&$(window).width()<769){var t="";t=getUrlVars().category,location.pathname.split("/")[1]&&(t=location.pathname.split("/")[1]),$(".category__list").remove(),"undefined"!==t?$.ajax({method:"POST",url:"/ajaxCatFilter",data:{category:t,_token:token}}).done(function(e){if(!0===e.success){$(".js-category").html(e.html);var a=getUrlVars().service;$.ajax({method:"POST",url:"/ajaxServiceFilter",data:{checked:a,category:t,_token:token}}).done(function(e){!0===e.success&&($(".catalog-filter__category").children(".category__dropdown").remove(),$(".catalog-filter__category").append(e.html))})}}):$.ajax({method:"POST",url:"/ajaxCatFilter",data:{_token:token}}).done(function(e){!0===e.success&&$(".js-category").html(e.html)})}if(0<$(".catalog-filter__item_price").length){var e,a,r,n,i=document.getElementById("js-catalog-filter-slider"),o=$("#js-catalog-filter-slider").data("start"),c=$("#js-catalog-filter-slider").data("end"),l=[$("#jsPriceStart"),$("#jsPriceEnd")];e=""==l[0].text()?o:parseInt(l[0].text()),a=""==l[1].text()?c:parseInt(l[1].text()),noUiSlider.create(i,{start:[e,a],connect:!0,step:10,range:{min:o,max:c}}),i.noUiSlider.on("update",function(e,a){l[a].text(parseInt(e[a]))}),i.noUiSlider.on("change",function(e){updateUrlArray(s,"minPrice",parseInt(e[0]),"add",!0),r=updateUrlArray(s,"maxPrice",parseInt(e[1]),"add",!0),n=generateStingFromArray(s=r),window.history.replaceState("url","",n),sendAjax()})}$(".js-filter-gender").on("change",function(){var e,a,t=$(this).data("gender");e=updateUrlArray(s,"gender",t,"add",!0),a=generateStingFromArray(s=e),window.history.replaceState("url","",a),sendAjax()}),$(window).width()<769&&$(document).on("change",".js-filter-category",function(){var e,a,t=$(this).data("category");delete(e=updateUrlArray(s,"category",t,"add",!0)).service,delete e.category,a=generateStingFromArray(e),window.history.replaceState("url","",a),window.history.pushState("","",t),$.ajax({method:"POST",url:"/ajaxServiceFilter",data:{category:t,_token:token}}).done(function(e){!0===e.success&&($(".catalog-filter__category").children(".category__dropdown").remove(),$(".catalog-filter__category").append(e.html))})}),$(".js-filter-place").on("change",function(){var e,a,t=$(this).data("place"),r=$.getUrlVar("place");if(0!==t)e=updateUrlArray(s,"place",t,"add",!0);else{if(void 0===r)return!1;e=updateUrlArray(s,"place",r,"delete")}a=generateStingFromArray(s=e),window.history.replaceState("url","",a),sendAjax()}),$(".jsSelectSort").on("change",function(){var e,a,t=$(this).val(),r="order",n=$.getUrlVar("order");if(null!==t){if("jsPriceUp"===t)a=updateUrlArray(s,r,"up","add",!0);else if("jsPriceDown"===t){a=updateUrlArray(s,r,"down","add",!0)}else if("jsNewSort"===t){a=updateUrlArray(s,r,"new","add",!0)}else"jsClearSort"===t&&(a=updateUrlArray(s,r,n,"delete"))}else{if(void 0===n)return!1;a=updateUrlArray(s,r,n,"delete")}e=generateStingFromArray(s=a),window.history.replaceState("url","",e),sendAjax()}),$(".js-catalog-filter--close").on("click",function(){return $(".catalog-filter").removeClass("is-open"),$("html").removeAttr("style"),!1}),$(".js-btn-pulse").on("click",function(){var e=window.location.href;window.open(e,"_self")})}}),$.extend({getUrlVars:function(){for(var e,a=[],t=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),r=0;r<t.length;r++)e=t[r].split("="),a.push(e[0]),a[e[0]]=e[1];return a},getUrlVar:function(e){return $.getUrlVars()[e]}}),$(document).ready(function(){var s=$(".js-upload-file");if(0<s.length){var i=[];s.on("change",function(e){var a=this.files,t=new FormData,r=$(this).data("rand"),n=$(this).data("crop"),s=$(this).data("user"),i=$(this).data("table"),o=$(this).data("addmodel"),c=$(".bb-upload__list");return e.stopPropagation(),e.preventDefault(),void 0===a||($.each(a,function(e,a){t.append(e,a)}),t.append("randValue",r),t.append("cropParams",n),t.append("modelID",s),t.append("addModelID",o),t.append("table",i),t.append("_token",token),$.ajax({method:"POST",url:"/ajaxIndexAddImage",data:t,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(e){if(!0===e.success){var a=e.arrImagesBlocks;c.append(a),$(".js-lk-empty").hide()}else e.error&&alert(e.error)}})),!1}),$(document).on("click",".js-delete-file",function(e){e.stopPropagation(),e.preventDefault();var a=0,t=$(this),r=t.parent().prev().children().data("name"),n=s.data("rand");i.push(r),$.ajax({method:"POST",url:"/ajaxRemoveImage",data:{fileName:r,randValue:n,_token:token}}).done(function(e){1==e.success&&(t.parent().parent().remove(),$(".bb-upload__item").each(function(){a++}),0==a&&$(".js-lk-empty").show())})})}});